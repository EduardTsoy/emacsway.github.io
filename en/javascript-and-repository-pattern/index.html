<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en-us">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Implementation of Repository pattern for browser’s JavaScript &mdash; @emacsway&#39;s blog</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/jquery-toast-plugin/jquery.toast.min.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/jquery-toast-plugin/jquery.toast.min.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../about/" />
    <link rel="top" title="@emacsway&#39;s blog" href="../../" />
  

   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />


    

        <meta http-equiv="Last-Modified" content="Tue, 24 Oct 2017 00:36:50 GMT" />
        
            <meta name="description" content="Good architecture makes you free from certain implementation. It allows you to postpone the moment of decision on implementation and begin code construction even without the decision. The most important point is that you gain the opportunity to make a decision at the time of the greatest awareness, and you can also easily replace a specific implementation with any other. This responsibility is assigned to the Repository." />
        
        
            <meta property="og:image" content="../../_static/logo.jpg" />
            <link rel="image_src" href="../../_static/logo.jpg" />
        

        <link rel="canonical" href="https://emacsway.github.io/en/javascript-and-repository-pattern/" />

        <script type="text/javascript">
            setTimeout(function() {
                $.toast({
                    text: 'If you like this site, please support it with an external link or share it with an social nerwork. Thanks!',
                    position: 'bottom-right',
                    hideAfter: 7000
                });
            }, 30000);
        </script>

    


  
  <link rel="alternate" type="application/atom+xml"  href="../../blog/atom.xml" title="@emacsway's blog">
  
  
  <link href="True" rel="stylesheet">
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.postlist a {font-style: italic;}
    ul.postlist-style-disc {list-style-type: disc;}
    ul.postlist-style-none {list-style-type: none;}
    ul.postlist-style-circle {list-style-type: circle;}
  </style>

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="implementation-of-repository-pattern-for-browser-s-javascript">
<h1><a class="toc-backref" href="#id30">Implementation of Repository pattern for browser&#8217;s JavaScript</a><a class="headerlink" href="#implementation-of-repository-pattern-for-browser-s-javascript" title="Permalink to this headline">¶</a></h1>
<p>Good architecture makes you free from certain implementation.
It allows you to postpone the moment of decision on implementation and <a class="reference external" href="http://martinfowler.com/eaaCatalog/serviceStub.html">begin code construction even without the decision</a>.
The most important point is that you gain the opportunity to make a decision at the time of the greatest awareness, and you can also easily replace a specific implementation with any other.
This responsibility is assigned to the <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a>.</p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#implementation-of-repository-pattern-for-browser-s-javascript" id="id30">Implementation of Repository pattern for browser&#8217;s JavaScript</a></li>
<li><a class="reference internal" href="#domain-model" id="id31">Domain Model</a></li>
<li><a class="reference internal" href="#reactive-programming-paradigm" id="id32">Reactive programming paradigm</a></li>
<li><a class="reference internal" href="#examples-of-implementations-of-repository-pattern-by-javascript" id="id33">Examples of implementations of Repository pattern by JavaScript</a></li>
<li><a class="reference internal" href="#implementation-of-relational-relations" id="id34">Implementation of relational relations</a><ul>
<li><a class="reference internal" href="#synchronous-programming" id="id35">Synchronous programming</a></li>
<li><a class="reference internal" href="#rejecting-relations" id="id36">Rejecting relations</a></li>
<li><a class="reference internal" href="#asynchronous-programming" id="id37">Asynchronous programming</a></li>
<li><a class="reference internal" href="#functional-programming" id="id38">Functional Programming</a></li>
<li><a class="reference internal" href="#minor-offtopic" id="id39">Minor offtopic</a></li>
<li><a class="reference internal" href="#implementation-of-relations-by-assigning" id="id40">Implementation of relations by assigning</a></li>
</ul>
</li>
<li><a class="reference internal" href="#source-code" id="id41">Source code</a></li>
</ul>
</div>
<p>Thus, you have a complete abstraction from the data source, whether it&#8217;s REST-API, MBaaS, SaaS, IndexedDB, HTML, third-party service for JSON-RPC protocol or <a class="reference external" href="http://martinfowler.com/eaaCatalog/serviceStub.html">Service Stub</a>.</p>
<blockquote>
<div>&#8220;We often forget that it is also best to postpone decisions until the last possible moment.
This isn’t lazy or irresponsible; it lets us make informed choices with the best possible information.
A premature decision is a decision made with suboptimal knowledge. We will have that
much less customer feedback, mental reflection on the project, and experience with our
implementation choices if we decide too soon.&#8221;
(«Clean Code: A Handbook of Agile Software Craftsmanship» <a class="footnote-reference" href="#fnccode" id="id1">[1]</a>)</div></blockquote>
<blockquote>
<div>A good architecture allows major decision to be deferred! (Robert Martin)</div></blockquote>
<blockquote>
<div>You would make big decisions as
late in the process as possible, to defer the cost of making the decisions and to have
the greatest possible chance that they would be right. You would only implement
what you had to, in hopes that the needs you anticipate for tomorrow wouldn&#8217;t come
true.
(Kent Beck <a class="footnote-reference" href="#fnxp" id="id2">[10]</a>)</div></blockquote>
<p>In addition, you have the opportunity to implement patterns <a class="reference external" href="http://martinfowler.com/eaaCatalog/identityMap.html">Identity Map</a> and <a class="reference external" href="http://martinfowler.com/eaaCatalog/unitOfWork.html">Unit of Work</a>.
The last one is very often in demand, since it allows you to save only changed objects of the finally formed aggregate of nested objects on the server, or roll back the state of local objects in case the data can not be saved (the user has changed his mind or entered invalid data).</p>
</div>
<div class="section" id="domain-model">
<h1><a class="toc-backref" href="#id31">Domain Model</a><a class="headerlink" href="#domain-model" title="Permalink to this headline">¶</a></h1>
<p>The greatest advantage of the <a class="reference external" href="http://martinfowler.com/eaaCatalog/domainModel.html">Domain Model</a> in the program is the ability to use the principles of Domain-Driven Design (DDD) <a class="footnote-reference" href="#fnddd" id="id3">[4]</a>.
If the Models contain only business logic, and are devoid of service logic, then they can easily be read by domain expert (ie, the customer&#8217;s representative).
This frees you from the need to create UML diagrams for discussions and allows you to achieve the highest level of mutual understanding, productivity, and quality of implementation of the models.</p>
<p>In one project I tried to implement a fairly complex domain logic (which contained about 20 domain model) in the paradigm of reactive programming, when the attributes of the model instance, containing the aggregation annotations or dependent on them, change its values by reacting to changes in other models and storages.
The bottom line is that all this reactive logic no longer belonged to the domain model itself, and was located in a different sort of <a class="reference external" href="https://en.wikipedia.org/wiki/Observer_pattern">Observers</a> and handlers.</p>
<blockquote>
<div>&#8220;The whole point of objects is that they are a technique to package data with the processes used
on that data. A classic smell is a method that seems more interested in a class other than the one
it actually is in. The most common focus of the envy is the data.&#8221;
(«Refactoring: Improving the Design of Existing Code» <a class="footnote-reference" href="#fnrefactoring" id="id4">[6]</a>)</div></blockquote>
<blockquote>
<div>&#8220;Good design puts the logic near the data it operates on.&#8221;
(Kent Beck <a class="footnote-reference" href="#fnxp" id="id5">[10]</a>)</div></blockquote>
<blockquote>
<div><p>&#8220;If the framework&#8217;s partitioning conventions pull apart the elements implementing the
conceptual objects, the code no longer reveals the model.</p>
<p>There is only so much partitioning a mind can stitch back together, and if the framework uses
it all up, the domain developers lose their ability to chunk the model into meaningful pieces.&#8221;
(«Domain-Driven Design: Tackling Complexity in the Heart of Software» <a class="footnote-reference" href="#fnddd" id="id6">[4]</a>)</p>
</div></blockquote>
<p>This led to such a huge number of intricacies of listeners that the superiority in performance was lost, but before that was lost readability.
Even I could not understand the next day what a particular code fragment does, I&#8217;m not talking about the domain expert.
This radically destroyed the principles of Domain-Driven Design, and significantly <a class="reference internal" href="../how-to-quickly-develop-high-quality-code/"><span class="doc">reduced the speed of developing new project features</span></a>.</p>
<p>Hopes for this approach finally collapsed when it was revealed that each instance of the model is to change the values of its attributes that contain aggregate annotations or dependent upon, depending on the context of use (display selected group or filter criteria).</p>
<p>Subsequently, the models recovered their conceptual outlines and code readability, and at the same time preserved the mechanism of reactions for adding, changing or deleting objects.
To achieve this result, I had to create my own library implementing the Repository pattern, since I could not find existing solutions for relational data with quality code base.</p>
</div>
<div class="section" id="reactive-programming-paradigm">
<h1><a class="toc-backref" href="#id32">Reactive programming paradigm</a><a class="headerlink" href="#reactive-programming-paradigm" title="Permalink to this headline">¶</a></h1>
<p>Today it is fashionable to get involved in reactive programming.
Did you know that dojo developers first <a class="reference external" href="https://github.com/dojo/dojo/commit/4bd91a5939d4dbc8a43d673cc279bb3d39ed0895#diff-48ec1f2998cbe6d644df0c9abd32d9d0R35">applied reactive programming</a> in their implementation of the Repository pattern as early as September 13, 2010?</p>
<p>Reactive programming complements (rather than contrasts) the <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a> pattern, as it&#8217;s evidenced by the experience of <a class="reference external" href="https://dojotoolkit.org/reference-guide/1.10/dojo/store.html">dojo.store</a>, <a class="reference external" href="http://dstorejs.io/">Dstore</a> and the new <a class="reference external" href="https://github.com/dojo/stores">Dojo 2 - data stores</a>.</p>
<p>The developers of dojo are a team of highly qualified specialists whose libraries are used by such reputable companies as IBM.
An example of how seriously and comprehensively they solves problems is the <a class="reference external" href="http://requirejs.org/docs/history.html">history of the RequireJS library</a>.</p>
</div>
<div class="section" id="examples-of-implementations-of-repository-pattern-by-javascript">
<h1><a class="toc-backref" href="#id33">Examples of implementations of Repository pattern by JavaScript</a><a class="headerlink" href="#examples-of-implementations-of-repository-pattern-by-javascript" title="Permalink to this headline">¶</a></h1>
<p>Examples of the simplest implementations of the Repository pattern by JavaScript in the project <a class="reference external" href="http://todomvc.com/">todomvc.com</a>:</p>
<ul class="simple">
<li>Angular2: <a class="reference external" href="https://github.com/tastejs/todomvc/blob/gh-pages/examples/angular2/app/services/store.ts">https://github.com/tastejs/todomvc/blob/gh-pages/examples/angular2/app/services/store.ts</a></li>
<li>Angular1: <a class="reference external" href="https://github.com/tastejs/todomvc/blob/gh-pages/examples/angularjs/js/services/todoStorage.js">https://github.com/tastejs/todomvc/blob/gh-pages/examples/angularjs/js/services/todoStorage.js</a></li>
<li>React: <a class="reference external" href="https://github.com/tastejs/todomvc/blob/gh-pages/examples/react-alt/js/stores/todoStore.js">https://github.com/tastejs/todomvc/blob/gh-pages/examples/react-alt/js/stores/todoStore.js</a></li>
</ul>
<p>Other implementations:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/dojo/stores">Dojo2 Stores</a> - Excellent implementation of <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a> pattern in paradigm of <a class="reference external" href="https://en.wikipedia.org/wiki/Reactive_programming">Reactive Programming</a> for non-relational data.</li>
<li><a class="reference external" href="http://dstorejs.io/">Dstore</a> - yet another excellent implementation of <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a> pattern.</li>
<li><a class="reference external" href="https://dojotoolkit.org/reference-guide/1.10/dojo/store.html">Dojo1 Store</a> - Dojo1 implementation of <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a> pattern.</li>
<li><a class="reference external" href="http://www.js-data.io/">JS-Data</a> - ORM written by JavaScript for relational data. Does not support composite relations.</li>
<li><a class="reference external" href="https://www.sitepoint.com/9-javascript-libraries-working-with-local-storage/">9 JavaScript Libraries for Working with Local Storage</a> - article with interesting comments.</li>
<li><a class="reference external" href="http://devcenter.kinvey.com/angular/guides/datastore">Kinvey Data Store</a> - implementation of <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a> pattern by MBaaS Kinvey, <a class="reference external" href="https://github.com/Kinvey/js-sdk/tree/master/src/datastore/src">source code</a></li>
<li><a class="reference external" href="https://github.com/vincentracine/pocketjs">Pocket.js</a> - a wrapper for the window.localStorage. It provides helpful methods which utilise MongoDB&#8217;s proven syntax and provides a powerful lightweight abstraction from the complexity of managing and querying local storage.</li>
</ul>
<p>I would like to add here <a class="reference external" href="https://emberjs.com/">Ember.js</a>, but it implements the <a class="reference external" href="http://www.martinfowler.com/eaaCatalog/activeRecord.html">ActiveRecord</a> pattern.</p>
</div>
<div class="section" id="implementation-of-relational-relations">
<h1><a class="toc-backref" href="#id34">Implementation of relational relations</a><a class="headerlink" href="#implementation-of-relational-relations" title="Permalink to this headline">¶</a></h1>
<div class="section" id="synchronous-programming">
<h2><a class="toc-backref" href="#id35">Synchronous programming</a><a class="headerlink" href="#synchronous-programming" title="Permalink to this headline">¶</a></h2>
<p>At the dawn of ORM, the Data Mappers retrieved from the database all related objects with a single query (see <a class="reference external" href="https://bitbucket.org/emacsway/openorm/src/default/python/">example of implementation</a>).</p>
<p>Domain-Driven Design approaches relations more strictly, and considers relations from the point of view of conceptual contour of an aggregate of nested objects <a class="footnote-reference" href="#fnddd" id="id7">[4]</a>.
The object can be accessed either by reference (from the parent object to the embedded object) or through the Repository.
It is also important the direction of relations and the principle of minimal sufficiency (&#8220;distillation of models&#8221; <a class="footnote-reference" href="#fnddd" id="id8">[4]</a>).</p>
<blockquote>
<div><p>In real life, there are lots of many-to-many associations, and a great number are naturally
bidirectional. The same tends to be true of early forms of a model as we brainstorm and explore
the domain. But these general associations complicate implementation and maintenance.
Furthermore, they communicate very little about the nature of the relationship.</p>
<p>There are at least three ways of making associations more tractable.</p>
<ol class="arabic simple">
<li>Imposing a traversal direction</li>
<li>Adding a qualifier, effectively reducing multiplicity</li>
<li>Eliminating nonessential associations</li>
</ol>
<p>It is important to constrain relationships as much as possible. A bidirectional association means
that both objects can be understood only together. When application requirements do not call for
traversal in both directions, adding a traversal direction reduces interdependence and simplifies
the design. Understanding the domain may reveal a natural directional bias.
(«Domain-Driven Design: Tackling Complexity in the Heart of Software» <a class="footnote-reference" href="#fnddd" id="id9">[4]</a>)</p>
</div></blockquote>
<blockquote>
<div>Minimalist design of associations helps simplify traversal and limit the explosion of relationships
somewhat, but most business domains are so interconnected that we still end up tracing long,
deep paths through object references. In a way, this tangle reflects the realities of the world,
which seldom obliges us with sharp boundaries. It is a problem in a software design.
(«Domain-Driven Design: Tackling Complexity in the Heart of Software» <a class="footnote-reference" href="#fnddd" id="id10">[4]</a>)</div></blockquote>
<p>With the advent of ORM, lazy evaluation actively began to use to resolve ties synchronous programming.
Python community actifely uses <a class="reference external" href="https://docs.python.org/3/howto/descriptor.html">Descriptors</a> for this purpose, but Java - AOP and Cross-Cutting Concerns <a class="footnote-reference" href="#fnccode" id="id11">[1]</a>.</p>
<p>The key is to free the Domain Model from the data access logic.
This is required by the principle of clean architecture to reduce coupling (<a class="reference external" href="http://wiki.c2.com/?CouplingAndCohesion">Coupling</a>), and by the principle of simplicity of testing.
The greatest success is achieved by the principle of Cross-Cutting Concerns which completely frees the model from the service logic.</p>
<p>With the advent of ORM the implementation of relations has become so easy that no one longer think about it.
Where unidirectional relations are required, developers can easily apply bidirectional relations.
Utilities for optimizing the selection of related objects have appeared, which implicitly preload all related objects, which significantly reduces the number of calls to the database.</p>
</div>
<div class="section" id="rejecting-relations">
<h2><a class="toc-backref" href="#id36">Rejecting relations</a><a class="headerlink" href="#rejecting-relations" title="Permalink to this headline">¶</a></h2>
<p>It is worth mentioning another widespread point of view, which says that an object should not be responsible for its relations, and only Repository can have an exclusive right to access the object.
Some respected by me friends adhere to this point of view.</p>
</div>
<div class="section" id="asynchronous-programming">
<h2><a class="toc-backref" href="#id37">Asynchronous programming</a><a class="headerlink" href="#asynchronous-programming" title="Permalink to this headline">¶</a></h2>
<p>The rise in popularity of asynchronous applications has forced us to reconsider the established notions about the implementation of lazy relations.
Asynchronous access to each lazy relation of each object significantly complicates the clarity of the program code and prevents optimization.</p>
<p>This has increased the popularity of object-oriented database in asynchronous programming that allows to save aggregates entirely.
Increasingly, REST-frameworks began to be used to <a class="reference external" href="http://www.django-rest-framework.org/api-guide/serializers/#dealing-with-nested-objects">transfer aggregates of nested objects to the client</a>.</p>
<blockquote>
<div><p>To do anything with an object, you have to hold a reference to it. How do you get that reference?
One way is to create the object, as the creation operation will return a reference to the new
object. A second way is to traverse an association. You start with an object you already know and
ask it for an associated object. Any object-oriented program is going to do a lot of this, and these
links give object models much of their expressive power. But you have to get that first object.</p>
<p>I actually encountered a project once in which the team was attempting, in an enthusiastic
embrace of MODEL-DRIVEN DESIGN , to do all object access by creation or traversal! Their objects
resided in an object database, and they reasoned that existing conceptual relationships would
provide all necessary associations. They needed only to analyze them enough, making their entire
domain model cohesive. This self-imposed limitation forced them to create just the kind of endless
tangle that we have been trying to avert over the last few chapters, with careful implementation of
ENTITIES and application of AGGREGATES . The team members didn&#8217;t stick with this strategy long, but
they never replaced it with another coherent approach. They cobbled together ad hoc solutions
and became less ambitious.</p>
<p>Few would even think of this approach, much less be tempted by it, because they store most oftheir objects in relational databases.
This storage technology makes it natural to use the third way
of getting a reference: Execute a query to find the object in a database based on its attributes, or
find the constituents of an object and then reconstitute it.
(«Domain-Driven Design: Tackling Complexity in the Heart of Software» <a class="footnote-reference" href="#fnddd" id="id12">[4]</a>)</p>
</div></blockquote>
<p>The need for processing aggregates has intensified interest in functional programming, especially in combination with reactive programming paradigm.</p>
<p>However, the solution to one problem creates another problem.</p>
</div>
<div class="section" id="functional-programming">
<h2><a class="toc-backref" href="#id38">Functional Programming</a><a class="headerlink" href="#functional-programming" title="Permalink to this headline">¶</a></h2>
<p>Functional programming is more difficult to use for domain objects, since it is more difficult to structure logically (especially if programming language does not support <a class="reference external" href="https://en.wikipedia.org/wiki/Multiple_dispatch">multiple dispatching</a>).
This often leads to unreadable code that expresses not &#8220;what&#8221; it does, but &#8220;how&#8221; it does something incomprehensible.</p>
<blockquote>
<div><p>If you wanted polymophism in C, you’d have to manage those pointers yourself;
and that’s hard. If you wanted polymorphism in Lisp you’d have to manage those pointers yourself (pass them in as arguments to some higher level algorithm (which, by the way IS the Strategy pattern.))
But in an OO language, those pointers are managed for you.
The language takes care to initialize them, and marshal them, and call all the functions through them.</p>
<p>... There really is only one benefit to Polymorphism; but it’s a big one. It is the inversion of source code and run time dependencies.
(«OO vs FP» <a class="footnote-reference" href="#fnoovsop" id="id13">[7]</a>)</p>
</div></blockquote>
<blockquote>
<div>However, my experience is that the cost of change rises
more steeply without objects than with objects.
(Kent Beck <a class="footnote-reference" href="#fnxp" id="id14">[10]</a>)</div></blockquote>
<p>And yet, not clear intentions and objectives of the author - is a key issue when reading someone else&#8217;s code.</p>
<blockquote>
<div>A six-month study
conducted by IBM found that maintenance programmers &#8220;most
often said that understanding the original programmer&#8217;s intent was
the most difficult problem&#8221; (Fjelstad and Hamlen 1979).
(«Code Complete» <a class="footnote-reference" href="#fncodec" id="id15">[2]</a>)</div></blockquote>
<p>As it mentioned in the article &#8220;<a class="reference internal" href="../how-to-quickly-develop-high-quality-code/"><span class="doc">How to quickly develop high-quality code. Team work.</span></a>&#8221;, the developer reads the code 91% of the time while constructing the code, and only 9% of the time he enters the characters with keyboard.
And this means that poorly readable code affects 91% of the development velocity.</p>
<p>Also, this approach destroys all the benefits of using Domain-Driven Design and pull apart the elements implementing the conceptual objects, which leads to the code that no longer expresses the model.</p>
<p>All this <a class="reference external" href="https://groups.google.com/d/msg/reactjs/jbh50-GJxpg/82CHQKeaG54J">contributed to the appearance</a> in the ReactJS community of such libraries as:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/paularmstrong/normalizr">Normalizr</a> - Normalizes (decomposes) nested JSON according to a schema.</li>
<li><a class="reference external" href="https://github.com/gpbl/denormalizr">Denormalizr</a> - Denormalize data normalized with normalizr.</li>
</ul>
</div>
<div class="section" id="minor-offtopic">
<h2><a class="toc-backref" href="#id39">Minor offtopic</a><a class="headerlink" href="#minor-offtopic" title="Permalink to this headline">¶</a></h2>
<p>Despite the fact that functional programming techniques are often used together with the paradigm of reactive programming, in their essence these paradigms are not always suitable for combination in the canonical form for web development.</p>
<p>This is because reactive programming is based on the propagation of changes, i.e. it implies the existence of variables and assignment.</p>
<blockquote>
<div><p>This means that it becomes possible to express static (e.g. arrays) or dynamic (e.g. event emitters) data streams with ease via the employed programming language(s), and that an inferred dependency within the associated execution model exists, which facilitates the automatic propagation of the change involved with data flow.</p>
<p>For example, in an imperative programming setting, <code class="docutils literal"><span class="pre">a</span> <span class="pre">:=</span> <span class="pre">b</span> <span class="pre">+</span> <span class="pre">c</span></code> would mean that <code class="docutils literal"><span class="pre">a</span></code> is being assigned the result of <code class="docutils literal"><span class="pre">b</span> <span class="pre">+</span> <span class="pre">c</span></code> in the instant the expression is evaluated, and later, the values of <code class="docutils literal"><span class="pre">b</span></code> and/or <code class="docutils literal"><span class="pre">c</span></code> can be changed with no effect on the value of <code class="docutils literal"><span class="pre">a</span></code>.
However, in reactive programming, the value of <code class="docutils literal"><span class="pre">a</span></code> is automatically updated whenever the values of <code class="docutils literal"><span class="pre">b</span></code> and/or <code class="docutils literal"><span class="pre">c</span></code> change;
without the program having to re-execute the sentence <code class="docutils literal"><span class="pre">a</span> <span class="pre">:=</span> <span class="pre">b</span> <span class="pre">+</span> <span class="pre">c</span></code> to determine the presently assigned value of <code class="docutils literal"><span class="pre">a</span></code>.</p>
<p>... For example, in an model–view–controller (MVC) architecture, reactive programming can facilitate changes in an underlying model that automatically are reflected in an associated view, and contrarily.
(&#8220;<a class="reference external" href="https://en.wikipedia.org/wiki/Reactive_programming">Reactive programming</a>&#8221;, wikipedia)</p>
</div></blockquote>
<p>That is why reactive programming paradigm <a class="reference external" href="https://en.wikipedia.org/wiki/Reactive_programming#Approaches">can be combined with different paradigms</a>, imperative, object-oriented and functional.</p>
<p>However, the whole point of the matter is that in the canonical form of functional programming does not has variables (from the word &#8220;vary&#8221;), i.e. changeable state:</p>
<blockquote>
<div><p>A true functional programming language has no assignment operator.
You cannot change the state of a variable.
Indeed, the word “variable” is a misnomer in a functional language because you cannot vary them.</p>
<p>...The overriding difference between a functional language and a non-functional language is that functional languages don’t have assignment statements.</p>
<p>... The point is that a functional language imposes some kind of ceremony or discipline on changes of state. You have to jump through the right hoops in order to do it.</p>
<p>And so, for the most part, you don’t.
(«OO vs FP» <a class="footnote-reference" href="#fnoovsop" id="id16">[7]</a>)</p>
</div></blockquote>
<p>Therefore, the use of functional programming techniques does not make the program functional until the program has a variable state - it&#8217;s just procedural programming.
And if so, then the rejection of Domain-Driven Design just takes away the superiority of both approaches (neither object-oriented programming polymorphism nor the immutability of functional programming), and combines the all worst, similar to hybrid objects <a class="footnote-reference" href="#fnccode" id="id17">[1]</a>, and does not make program really functional.</p>
<blockquote>
<div><p>Hybrids</p>
<p>This confusion sometimes leads to unfortunate hybrid structures that are half object and
half data structure. They have functions that do significant things, and they also have either
public variables or public accessors and mutators that, for all intents and purposes, make
the private variables public, tempting other external functions to use those variables the
way a procedural program would use a data structure (this is sometimes called Feature Envy from &#8220;Refactoring&#8221; <a class="footnote-reference" href="#fnrefactoring" id="id18">[6]</a>).
Such hybrids make it hard to add new functions but also make it hard to add new data
structures. They are the worst of both worlds. Avoid creating them. They are indicative of a
muddled design whose authors are unsure of—or worse, ignorant of—whether they need
protection from functions or types.
(«Clean Code: A Handbook of Agile Software Craftsmanship» <a class="footnote-reference" href="#fnccode" id="id19">[1]</a>)</p>
</div></blockquote>
<p>Canonical functional programming has no state and therefore ideally suited for distributed computing and data flow processing.</p>
<blockquote>
<div><p>The benefit of not using assignment statements should be obvious.
You can’t have concurrent update problems if you never update anything.</p>
<p>Since functional programming languages do not have assignment statements, programs written in those languages don’t change the state of very many variables.
Mutation is reserved for very specific sections of the system that can tolerate the high ceremony required.
Those sections are inherently safe from multiple threads and multiple cores.</p>
<p>The bottom line is that functional programs are much safer in multiprocessing and multiprocessor environments.
(«OO vs FP» <a class="footnote-reference" href="#fnoovsop" id="id20">[7]</a>)</p>
</div></blockquote>
<p>Does this mean that the object-oriented programming paradigm is opposed to the functional programming programming?</p>
<p>Despite the fact that the OOP paradigm is traditionally considered as a kind of imperative paradigm, i.e. based on the state of the program, Robert C. Martin makes an amazing conclusion - as objects provide their interface, i.e. behavior, and hide their state, they do not contradict the functional programming paradigm.</p>
<blockquote>
<div>&#8220;Objects are not data structures.
Objects may use data structures; but the manner in which those data structures are used or contained is hidden.
This is why data fields are private.
From the outside looking in you cannot see any state.
All you can see are functions.
Therefore Objects are about functions not about state.&#8221;
(«OO vs FP» <a class="footnote-reference" href="#fnoovsop" id="id21">[7]</a>)</div></blockquote>
<p>That&#8217;s why some classical functional programming languages support OOP:</p>
<ul>
<li><p class="first"><a class="reference external" href="https://www.gnu.org/software/emacs/manual/html_mono/eieio.html">Enhanced Implementation of Emacs Interpreted Objects</a></p>
</li>
<li><p class="first"><a class="reference external" href="https://en.wikipedia.org/wiki/Common_Lisp_Object_System">Common Lisp Object System</a></p>
<blockquote>
<div><p>Are these two disciplines mutually exclusive?
Can you have a language that imposes discipline on both assignment and pointers to functions?
Of course you can.
These two things don’t have anything to do with each other.
And that means that OO and FP are not mutually exclusive at all.
It means that you can write OO-Functional programs.</p>
<p>It also means that all the design principles, and design patterns, used by OO programmers can be used by functional programmers if they care to accept the discipline that OO imposes on their pointers to functions.
(«OO vs FP» <a class="footnote-reference" href="#fnoovsop" id="id22">[7]</a>)</p>
</div></blockquote>
</li>
</ul>
<p>Of course, objects in functional programming <a class="reference external" href="https://youtu.be/7Zlp9rKHGD4?t=50m">must be immutable</a>.</p>
<p>Objects can be emulated even by functional programming languages using closures, see article &#8220;<a class="reference external" href="https://martinfowler.com/bliki/FunctionAsObject.html">Function As Object</a>&#8221; by Martin Fowler.
Here you can not ignore the wonderful book &#8220;<a class="reference external" href="https://leanpub.com/fp-oo">Functional Programming for the Object-Oriented Programmer</a>&#8221; by Brian Marick.</p>
<p>Let&#8217;s remember the chapter &#8220;Chapter 6. Working Classes: 6.1. Class Foundations: Abstract Data Types (ADTs): Handling Multiple Instances of Data with ADTs in Non-Object-Oriented Environments&#8221; книги «Code Complete» <a class="footnote-reference" href="#fncodec" id="id23">[2]</a>.</p>
<blockquote>
<div>An abstract data type is a collection of data and operations that work on that data.
(«Code Complete» <a class="footnote-reference" href="#fncodec" id="id24">[2]</a>)</div></blockquote>
<blockquote>
<div>Abstract data types form the foundation for the concept of classes.
(«Code Complete» <a class="footnote-reference" href="#fncodec" id="id25">[2]</a>)</div></blockquote>
<blockquote>
<div>Thinking about ADTs first and classes second is an example of programming into a language vs. programming in one.
(«Code Complete» <a class="footnote-reference" href="#fncodec" id="id26">[2]</a>)</div></blockquote>
<p>I&#8217;m not here to rewrite all the advantages of ADT, you can read it in this chapter of this book.</p>
<p>But the original question was whether we should abandon the ADT in an object-oriented language for the design of domain objects in favor of &#8220;<a class="reference external" href="http://www.martinfowler.com/bliki/AnemicDomainModel.html">Anemic Domain Model</a>&#8221;?
And should we sacrifice all the benefits of Domain-Driven Design for the sake of the convenience of a particular implementation of relation resolving?</p>
<blockquote>
<div>The bottom, bottom line here is simply this.
OO programming is good, when you know what it is.
Functional programming is good when you know what it is.
And functional OO programming is also good once you know what it is.
(«OO vs FP» <a class="footnote-reference" href="#fnoovsop" id="id27">[7]</a>)</div></blockquote>
<p>It is also worth noting that not all kinds of relationships fit into the concept of aggregate.
If the object does not logically belong to the aggregate, then we can not put it into the aggregate for the sake of the convenience of resolving the relations.
For in this case, the interface will follow the implementation, which fundamentally destroys the fundamental principle of abstraction.
Also, the concept of an aggregate can not be used to emulate Many-To-Many relations and cross-link hierarchies.</p>
</div>
<div class="section" id="implementation-of-relations-by-assigning">
<h2><a class="toc-backref" href="#id40">Implementation of relations by assigning</a><a class="headerlink" href="#implementation-of-relations-by-assigning" title="Permalink to this headline">¶</a></h2>
<p>The principle of physical assignment of related objects is <a class="reference external" href="http://www.js-data.io/v3.0/docs/relations#section-eagerly-loading-relations">implemented also by the library js-data</a>.</p>
<p>In our library, we implemented both the ability to decompose aggregates of nested objects and the ability to compose aggregates from flat data of Repositories.
Moreover, the aggregate always keeps the actual state.
When you add, change, delete an object in the Repository, the changes automatically propagate to the structures of the corresponding aggregates.
The library implements this behavior as in the paradigm of reactive programming, as well as in the paradigm of event-driven programming (optional).</p>
<p>There is also the ability to create bidirectional relations.
But, despite the fact that modern interpreters able to easily collect garbage with reference cycles, it&#8217;s better when child objects are not aware of their parents from a conceptual point of view, if you don&#8217;t have a strong reason for that.</p>
<p>Thus, the implementation of communications does not require any service data access logic for the object, that provides zero <a class="reference external" href="http://wiki.c2.com/?CouplingAndCohesion">Coupling</a> and absolutly clear domain models.
This means that domain model can be instance of the &#8220;class&#8221; Object.</p>
<p>I also took into account the point of view that the domain model should not be responsible for the relations.
Therefore, there is the possibility of easy access to any object through its Repository.</p>
</div>
</div>
<div class="section" id="source-code">
<h1><a class="toc-backref" href="#id41">Source code</a><a class="headerlink" href="#source-code" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>Edge (unstable) repo - <a class="reference external" href="https://github.com/emacsway/store">https://github.com/emacsway/store</a></li>
<li>Canonical repo - <a class="reference external" href="https://github.com/joor/store-js-external">https://github.com/joor/store-js-external</a></li>
</ul>
<p>Эта статья на Русском языке &#8220;<a class="reference internal" href="../../ru/javascript-and-repository-pattern/"><span class="doc">Реализация паттерна Repository в браузерном JavaScript</span></a>&#8221;.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="fnccode" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id11">2</a>, <a class="fn-backref" href="#id17">3</a>, <a class="fn-backref" href="#id19">4</a>)</em> «<a class="reference external" href="http://www.informit.com/store/clean-code-a-handbook-of-agile-software-craftsmanship-9780132350884">Clean Code: A Handbook of Agile Software Craftsmanship</a>» by <a class="reference external" href="http://informit.com/martinseries">Robert C. Martin</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fncodec" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[2]</td><td><em>(<a class="fn-backref" href="#id15">1</a>, <a class="fn-backref" href="#id23">2</a>, <a class="fn-backref" href="#id24">3</a>, <a class="fn-backref" href="#id25">4</a>, <a class="fn-backref" href="#id26">5</a>)</em> «<a class="reference external" href="http://www.informit.com/store/code-complete-9780735619678">Code Complete</a>» Steve McConnell</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnpoeaa" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[3]</td><td>«<a class="reference external" href="https://www.martinfowler.com/books/eaa.html">Patterns of Enterprise Application Architecture</a>» by <a class="reference external" href="https://martinfowler.com/aboutMe.html">Martin Fowler</a>, David Rice, Matthew Foemmel, Edward Hieatt, Robert Mee, Randy Stafford</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnddd" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[4]</td><td><em>(<a class="fn-backref" href="#id3">1</a>, <a class="fn-backref" href="#id6">2</a>, <a class="fn-backref" href="#id7">3</a>, <a class="fn-backref" href="#id8">4</a>, <a class="fn-backref" href="#id9">5</a>, <a class="fn-backref" href="#id10">6</a>, <a class="fn-backref" href="#id12">7</a>)</em> «Domain-Driven Design: Tackling Complexity in the Heart of Software» by Eric Evans</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fngof" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[5]</td><td>«Design Patterns Elements of Reusable Object-Oriented Software» by Erich Gamma, Richard Helm, Ralph Johnson, John Vlissides, 1994</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnrefactoring" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[6]</td><td><em>(<a class="fn-backref" href="#id4">1</a>, <a class="fn-backref" href="#id18">2</a>)</em> «<a class="reference external" href="https://martinfowler.com/books/refactoring.html">Refactoring: Improving the Design of Existing Code</a>» by <a class="reference external" href="https://martinfowler.com/aboutMe.html">Martin Fowler</a>, Kent Beck, John Brant, William Opdyke, Don Roberts</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnoovsop" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[7]</td><td><em>(<a class="fn-backref" href="#id13">1</a>, <a class="fn-backref" href="#id16">2</a>, <a class="fn-backref" href="#id20">3</a>, <a class="fn-backref" href="#id21">4</a>, <a class="fn-backref" href="#id22">5</a>, <a class="fn-backref" href="#id27">6</a>)</em> «<a class="reference external" href="http://blog.cleancoder.com/uncle-bob/2014/11/24/FPvsOO.html">OO vs FP</a>» by Robert C. Martin</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnca" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[8]</td><td>«<a class="reference external" href="https://8thlight.com/blog/uncle-bob/2011/11/22/Clean-Architecture.html">Clean Architecture</a>» by Robert C. Martin</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fntca" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[9]</td><td>«<a class="reference external" href="https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html">The Clean Architecture</a>» by Robert C. Martin</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnxp" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[10]</td><td><em>(<a class="fn-backref" href="#id2">1</a>, <a class="fn-backref" href="#id5">2</a>, <a class="fn-backref" href="#id14">3</a>)</em> «<a class="reference external" href="http://www.informit.com/store/extreme-programming-explained-embrace-change-9780321278654">Extreme Programming Explained</a>» by Kent Beck</td></tr>
</tbody>
</table>
</div>

  <div class="section">
  
    


  
  
  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../">
    <img class="logo" src="../../_static/logo.jpg" alt="Logo"/>
    
    <h1 class="logo logo-name">@emacsway's blog</h1>
    
  </a>
</p>









  
  
  <h2>
  
    <i class="fa fa-pencil"></i>
     Draft 
  
  </h2>

  <ul>
    

  
  <li><i class="fa-fw fa fa-user"></i>
    
      
      <a href="../../blog/author/ivan-zakrevsky/">Ivan Zakrevsky</a>
      
    </li>
  

  

  
  <li><i class="fa-fw fa fa-language"></i>
    
      
      <a href="../../blog/language/english/">English</a>
      
    </li>
  

  

  
  <li><i class="fa-fw fa fa-tags"></i>
      
    
      
      <a href="../../blog/tag/repository/">Repository</a>,
      
    
      
      <a href="../../blog/tag/orm/">ORM</a>,
      
    
      
      <a href="../../blog/tag/javascript/">JavaScript</a>,
      
    
      
      <a href="../../blog/tag/model/">Model</a>,
      
    
      
      <a href="../../blog/tag/ddd/">DDD</a>
      
    </li>
  
  
  </ul>


<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about/">About me</a></li>
</ul>


  <h3><a href="../../blog/">Recent Posts</a></h3>
  <ul>
    
    
      <li><a href="../../ru/about-quality-of-comments/">Aug 13 - О качестве комментариев в интернете</a></li>
    
      <li><a href="../../ru/javascript-and-repository-pattern/">Aug 06 - Реализация паттерна Repository в браузерном JavaScript</a></li>
    
      <li><a href="../../ru/django-framework/">Jul 26 - О моем опыте использования Django Framework</a></li>
    
      <li><a href="../django-framework/">Jul 26 - About my experience of using Django Framework</a></li>
    
      <li><a href="../../ru/service-layer/">Jul 17 - Проектирование Сервисного Слоя</a></li>
    
  </ul>

  <h3><a href="../../blog/tag/">Tags</a></h3>
  <style type="text/css">
    ul.ablog-cloud {list-style: none; overflow: auto;}
    ul.ablog-cloud li {float: left; height: 20pt; line-height: 18pt; margin-right: 5px;}
    ul.ablog-cloud a {text-decoration: none; vertical-align: middle;}
    li.ablog-cloud-1{font-size: 80%;}
    li.ablog-cloud-2{font-size: 95%;}
    li.ablog-cloud-3{font-size: 110%;}
    li.ablog-cloud-4{font-size: 125%;}
    li.ablog-cloud-5{font-size: 140%;}
  </style>
  <ul class="ablog-cloud">
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/architecture/">Architecture</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/db/">DB</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/ddd/">DDD</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/datamapper/">DataMapper</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/dependency-injection/">Dependency Injection</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/design/">Design</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/django/">Django</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-3">
        <a href="../../blog/tag/django-model/">Django Model</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/emacs/">Emacs</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/fowler/">Fowler</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/javascript/">JavaScript</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/model/">Model</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-4">
        <a href="../../blog/tag/orm/">ORM</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-5">
        <a href="../../blog/tag/python/">Python</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/repository/">Repository</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/sql/">SQL</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/storm-orm/">Storm ORM</a></li>
      
    
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/autocomplete/">autocomplete</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/cache/">cache</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/programming/">programming</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/refactoring/">refactoring</a></li>
      
    
  </ul>

  <h3><a href="../../blog/archive/">Archives</a></h3>
  <ul>
  
    
    <li><a href="../../blog/2017/">2017 (7)</a></li>
    
  
    
    <li><a href="../../blog/2016/">2016 (5)</a></li>
    
  
    
    <li><a href="../../blog/2015/">2015 (6)</a></li>
    
  
  </ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

    <div class="footer">
      &copy;2017, Ivan Zakrevsky.
      
      |
      Powered by <a href="http://ablog.readthedocs.org/">ABlog</a> &amp; <a href="http://sphinx-doc.org/">Sphinx 1.4.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
      |
      <a href="../../_sources/en/javascript-and-repository-pattern.txt"
          rel="nofollow">Page source</a>
    </div>

    

    


    


<!-- google.com/analytics counter -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-69288289-1', 'auto');
  ga('send', 'pageview');

</script>
<!-- /google.com/analytics counter -->


<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function (d, w, c) {
        (w[c] = w[c] || []).push(function() {
            try {
                w.yaCounter32948409 = new Ya.Metrika({
                    id:32948409,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true
                });
            } catch(e) { }
        });

        var n = d.getElementsByTagName("script")[0],
            s = d.createElement("script"),
            f = function () { n.parentNode.insertBefore(s, n); };
        s.type = "text/javascript";
        s.async = true;
        s.src = "https://mc.yandex.ru/metrika/watch.js";

        if (w.opera == "[object Opera]") {
            d.addEventListener("DOMContentLoaded", f, false);
        } else { f(); }
    })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/32948409" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->



  </body>
</html>
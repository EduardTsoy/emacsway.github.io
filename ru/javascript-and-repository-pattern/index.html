<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Реализация паттерна Repository в браузерном JavaScript &mdash; @emacsway&#39;s blog</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/jquery-toast-plugin/jquery.toast.min.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/jquery-toast-plugin/jquery.toast.min.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../about/" />
    <link rel="top" title="@emacsway&#39;s blog" href="../../" />
  

   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />


    

        <meta http-equiv="Last-Modified" content="Mon, 27 Nov 2017 00:00:00 GMT" />
        
            <meta name="description" content="Хорошая архитектура освобождает Вас от привязки к конкретной реализации. Она позволяет Вам отложить момент принятия решения о реализации, и начать конструирование кода еще не имея этого решения. Принципиально важным моментом является то, что Вы обретаете возможность принять решение в момент наибольшей информированности, а также всегда можете легко подменить конкретную реализацию на любую другую. Вот эта обязанность возложена на паттерн Repository." />
        
        
            <meta property="og:image" content="../../_static/logo.jpg" />
            <link rel="image_src" href="../../_static/logo.jpg" />
        

        <link rel="canonical" href="https://emacsway.github.io/ru/javascript-and-repository-pattern/" />

        <script type="text/javascript">
            setTimeout(function() {
                $.toast({
                    text: 'If you like this site, please support it with an external link or share it with an social nerwork. Thanks!',
                    position: 'bottom-right',
                    hideAfter: 7000
                });
            }, 30000);
        </script>

    


  
  <link rel="alternate" type="application/atom+xml"  href="../../blog/atom.xml" title="@emacsway's blog">
  
  
  <link href="True" rel="stylesheet">
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.postlist a {font-style: italic;}
    ul.postlist-style-disc {list-style-type: disc;}
    ul.postlist-style-none {list-style-type: none;}
    ul.postlist-style-circle {list-style-type: circle;}
  </style>

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="repository-javascript">
<h1><a class="toc-backref" href="#id43">Реализация паттерна Repository в браузерном JavaScript</a><a class="headerlink" href="#repository-javascript" title="Permalink to this headline">¶</a></h1>
<p>Хорошая архитектура освобождает Вас от привязки к конкретной реализации.
Она позволяет Вам отложить момент принятия решения о реализации, и <a class="reference external" href="http://martinfowler.com/eaaCatalog/serviceStub.html">начать конструирование кода еще не имея этого решения</a>.
Принципиально важным моментом является то, что Вы обретаете возможность принять решение в момент наибольшей информированности, а также всегда можете легко подменить конкретную реализацию на любую другую.
Вот эта обязанность возложена на паттерн <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a>.</p>
<div class="contents topic" id="id1">
<p class="topic-title first">Содержание</p>
<ul class="simple">
<li><a class="reference internal" href="#repository-javascript" id="id43">Реализация паттерна Repository в браузерном JavaScript</a></li>
<li><a class="reference internal" href="#domain-model" id="id44">Модель предметной области (Domain Model)</a></li>
<li><a class="reference internal" href="#id8" id="id45">Парадигма реактивного программирования</a></li>
<li><a class="reference internal" href="#repository-orm-javascript" id="id46">Примеры реализаций паттерна Repository и ORM в JavaScript</a></li>
<li><a class="reference internal" href="#id9" id="id47">Реализация реляционных связей</a><ul>
<li><a class="reference internal" href="#id10" id="id48">Синхронное программирование</a></li>
<li><a class="reference internal" href="#id17" id="id49">Отказ от связей</a></li>
<li><a class="reference internal" href="#id18" id="id50">Асинхронное программирование</a></li>
<li><a class="reference internal" href="#id21" id="id51">Функциональное программирование</a></li>
<li><a class="reference internal" href="#id25" id="id52">Лирическое отступление</a></li>
<li><a class="reference internal" href="#id39" id="id53">Реализация связей путем присваивания</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id40" id="id54">Исходный код</a></li>
</ul>
</div>
<p>Таким образом, у Вас появляется полная абстракция от источника данных, будь то REST-API, MBaaS, SaaS, IndexedDB, HTML, сторонний сервис по протоколу JSON-RPC или <a class="reference external" href="http://martinfowler.com/eaaCatalog/serviceStub.html">Service Stub</a>.</p>
<blockquote>
<div><p>&#8220;Однако мы часто забываем, что принятие решений лучше всего откладывать до последнего момента.
Дело не в лени или безответственности;
просто это позволяет принять информированное решение с максимумом возможной информации.
Преждевременное решение принимается на базе неполной информации.
Принимая решение слишком рано, мы лишаемся всего полезного, что происходит на более поздних стадиях:
обратной связи от клиентов, возможности поразмышлять над текущим состоянием проекта и опыта применения решений из области реализации.&#8221;</p>
<p>&#8220;We often forget that it is also best to postpone decisions until the last possible moment.
This isn’t lazy or irresponsible; it lets us make informed choices with the best possible information.
A premature decision is a decision made with suboptimal knowledge. We will have that
much less customer feedback, mental reflection on the project, and experience with our
implementation choices if we decide too soon.&#8221;
(«Clean Code: A Handbook of Agile Software Craftsmanship» <a class="footnote-reference" href="#fnccode" id="id2">[1]</a>)</p>
</div></blockquote>
<blockquote>
<div>&#8220;A good architecture allows major decision to be deferred!&#8221; (<a class="reference external" href="https://youtu.be/Nltqi7ODZTM?t=19m40s">Robert Martin</a>)</div></blockquote>
<blockquote>
<div><p>&#8220;Вы получаете возможность принимать важные решения настолько поздно,
насколько это возможно.
Это делается для того, чтобы осуществлять связанные с этим
затраты как можно позже.
Кроме того, если вы откладываете решение важных вопросов на более
поздний срок, тем самым вы повышаете вероятность того,
что выбранное вами решение окажется правильным. Другими
словами, сегодня вы должны реализовать только то, без чего сегодня не
обойтись, при этом вы можете рассчитывать на то, что проблемы, решение
которых вы отложили до завтра, развеются сами собой, то есть перестанут
быть актуальными.&#8221;</p>
<p>&#8220;You would make big decisions as
late in the process as possible, to defer the cost of making the decisions and to have
the greatest possible chance that they would be right. You would only implement
what you had to, in hopes that the needs you anticipate for tomorrow wouldn&#8217;t come
true.&#8221;
(Kent Beck <a class="footnote-reference" href="#fnxp" id="id3">[10]</a>)</p>
</div></blockquote>
<blockquote>
<div>&#8220;The best architects remove architecture by figuring out how to make things shiftable.&#8221; (<a class="reference external" href="https://youtu.be/VjKYO6DP3fo?t=17m59s">Martin Fowler</a>)</div></blockquote>
<p>Кроме того, у Вас появляется возможность реализовать паттерны <a class="reference external" href="http://martinfowler.com/eaaCatalog/identityMap.html">Identity Map</a> и <a class="reference external" href="http://martinfowler.com/eaaCatalog/unitOfWork.html">Unit of Work</a>.
Последний очень часто востребован, так как позволяет сохранять на сервере только измененные объекты окончательно сформированного агрегата вложенных объектов, либо выполнить откат состояния локальных объектов в случае, если сохранить данные невозможно (пользователь передумал или ввел невалидные данные).</p>
</div>
<div class="section" id="domain-model">
<h1><a class="toc-backref" href="#id44">Модель предметной области (Domain Model)</a><a class="headerlink" href="#domain-model" title="Permalink to this headline">¶</a></h1>
<p>Наибольшим преимуществом полноценных <a class="reference external" href="http://martinfowler.com/eaaCatalog/domainModel.html">Моделей предметной области</a> в программе является возможность использования принципов Domain-Driven Design (DDD) <a class="footnote-reference" href="#fnddd" id="id4">[4]</a>.
Если Модели содержат исключительно бизнес-логику, и освобождены от служебной логики, то они могут легко читаться специалистами предметной области (т.е. представителем заказчика).
Это освобождает Вас от необходимости создания UML-диаграмм для обсуждений и позволяет добиться максимально высокого уровня взаимопонимания, продуктивности, и качества реализации моделей.</p>
<p>В одном из проектов я пытался реализовать достаточно сложную доменную логику (которая содержала более 30 взаимосвязанных доменных Моделей) в парадигме реактивного программирования с push-алгоритмом, когда атрибуты экземпляра Модели, содержащие аннотации агрегации или зависимые от них, изменяли свое значение путем реакции на изменения других моделей и хранилищ.
Суть в том, что вся эта реактивная логика уже не принадлежала самой доменной модели, и располагалась в разного рода <a class="reference external" href="https://en.wikipedia.org/wiki/Observer_pattern">слушателях</a> и обработчиках.</p>
<blockquote>
<div><p>&#8220;Весь смысл объектов в том, что они позволяют хранить данные вместе с процедурами их обработки.
Классический пример дурного запаха – метод, который больше интересуется не тем классом, в котором он находится, а каким то другим.
Чаще всего предметом зависти являются данные.&#8221;</p>
<p>&#8220;The whole point of objects is that they are a technique to package data with the processes used
on that data. A classic smell is a method that seems more interested in a class other than the one
it actually is in. The most common focus of the envy is the data.&#8221;
(«Refactoring: Improving the Design of Existing Code» <a class="footnote-reference" href="#fnrefactoring" id="id5">[6]</a>)</p>
</div></blockquote>
<blockquote>
<div><p>&#8220;Хороший дизайн размещает логику рядом с данными, в отношении которых она действует.&#8221;</p>
<p>&#8220;Good design puts the logic near the data it operates on.&#8221;
(Kent Beck <a class="footnote-reference" href="#fnxp" id="id6">[10]</a>)</p>
</div></blockquote>
<blockquote>
<div><p>&#8220;Если требования архитектурной среды к распределению обязанностей таковы, что элементы, реализующие концептуальные объекты, оказываются физически разделенными, то код больше не выражает модель.</p>
<p>Нельзя разделять до бесконечности, у человеческого ума есть свои пределы, до которых он еще способен соединять разделенное;
если среда выходит ха это пределы, разработчики предметной области теряют способность расчленять модель на осмысленные фрагменты.&#8221;</p>
<p>&#8220;If the framework&#8217;s partitioning conventions pull apart the elements implementing the
conceptual objects, the code no longer reveals the model.</p>
<p>There is only so much partitioning a mind can stitch back together, and if the framework uses
it all up, the domain developers lose their ability to chunk the model into meaningful pieces.&#8221;
(«Domain-Driven Design: Tackling Complexity in the Heart of Software» <a class="footnote-reference" href="#fnddd" id="id7">[4]</a>)</p>
</div></blockquote>
<p>Это привело к такому огромному количеству хитросплетений слушателей, что превосходство в performance было утрачено, но еще раньше была утрачена читаемость кода.
Даже я не мог на следующий день сказать что делает тот или иной фрагмент кода, не говоря уже о специалисте предметной области.
Мало того, что это в корне разрушало принципы Domain-Driven Design, так это еще и в значительной мере <a class="reference internal" href="../../en/how-to-quickly-develop-high-quality-code/"><span class="doc">снижало скорость разработки новых функций проекта</span></a>.</p>
<p>Надежды на такой подход окончательно рухнули когда выяснилось, что каждый экземпляр модели должен изменять значения своих атрибутов, содержащих аннотации агрегации или зависимых от них, в зависимости от контекста использования (выбранной группировки отображения или критериев фильтрации).</p>
<p>Впоследствии модели вернули себе свои концептуальные контуры и читаемость кода, push-алгоритм был заменен на pull-алгоритм (точнее, на hybrid push-pull), и, вместе с тем, был сохранен механизм реакций при добавлении, изменении или удалении объектов.
Для достижения этого результата пришлось своими силами создать библиотеку реализующую паттерн Repository, так как существующих решений для реляционных данных с качественной кодовой базой я не смог найти.
Получилось что-то вроде Object-Relational Mapping (ORM) для JavaScript, включая паттерн Data Mapper (данные могут трансформироваться (отображаться) между объектами и постоянным хранилищем данных).</p>
</div>
<div class="section" id="id8">
<h1><a class="toc-backref" href="#id45">Парадигма реактивного программирования</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h1>
<p>Сегодня модно увлекаться реактивным программированием.
Знаете ли Вы, что разработчики dojo впервые <a class="reference external" href="https://github.com/dojo/dojo/commit/4bd91a5939d4dbc8a43d673cc279bb3d39ed0895#diff-48ec1f2998cbe6d644df0c9abd32d9d0R35">применили реактивное программирование</a> в своей реализации паттерна Repository еще 13 сентября 2010?</p>
<p>Реактивное программирование дополняет (а не противопоставляет) паттерн <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a>, о чем красноречиво свидетельствует опыт <a class="reference external" href="https://dojotoolkit.org/reference-guide/1.10/dojo/store.html">dojo.store</a>, <a class="reference external" href="http://dstorejs.io/">Dstore</a> и нового <a class="reference external" href="https://github.com/dojo/stores">Dojo 2 - data stores</a>.</p>
<p>Разработчики dojo - команда высококвалифицированных специалистов, чьи библиотеки используют такие серьезные компании как IBM.
Примером того, насколько серьезно и комплексно они подходят к решению проблем, может служить <a class="reference external" href="http://requirejs.org/docs/history.html">история библиотеки RequireJS</a>.</p>
</div>
<div class="section" id="repository-orm-javascript">
<h1><a class="toc-backref" href="#id46">Примеры реализаций паттерна Repository и ORM в JavaScript</a><a class="headerlink" href="#repository-orm-javascript" title="Permalink to this headline">¶</a></h1>
<p>Примеры простейших реализаций паттерна Repository на JavaScript в проекте <a class="reference external" href="http://todomvc.com/">todomvc.com</a>:</p>
<ul class="simple">
<li>Angular2: <a class="reference external" href="https://github.com/tastejs/todomvc/blob/gh-pages/examples/angular2/app/services/store.ts">https://github.com/tastejs/todomvc/blob/gh-pages/examples/angular2/app/services/store.ts</a></li>
<li>Angular1: <a class="reference external" href="https://github.com/tastejs/todomvc/blob/gh-pages/examples/angularjs/js/services/todoStorage.js">https://github.com/tastejs/todomvc/blob/gh-pages/examples/angularjs/js/services/todoStorage.js</a></li>
<li>React: <a class="reference external" href="https://github.com/tastejs/todomvc/blob/gh-pages/examples/react-alt/js/stores/todoStore.js">https://github.com/tastejs/todomvc/blob/gh-pages/examples/react-alt/js/stores/todoStore.js</a></li>
</ul>
<p>Другие реализации:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/dojo/stores">Dojo2 Stores</a> - Excellent implementation of <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a> pattern in paradigm of <a class="reference external" href="https://en.wikipedia.org/wiki/Reactive_programming">Reactive Programming</a> for non-relational data.</li>
<li><a class="reference external" href="http://dstorejs.io/">Dstore</a> - yet another excellent implementation of <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a> pattern.</li>
<li><a class="reference external" href="https://dojotoolkit.org/reference-guide/1.10/dojo/store.html">Dojo1 Store</a> - Dojo1 implementation of <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a> pattern.</li>
<li><a class="reference external" href="http://www.js-data.io/">JS-Data</a> - Object-Relational Mapping (ORM) written by JavaScript for relational data. Does not support composite relations.</li>
<li><a class="reference external" href="https://www.sitepoint.com/9-javascript-libraries-working-with-local-storage/">9 JavaScript Libraries for Working with Local Storage</a> - article with interesting comments.</li>
<li><a class="reference external" href="http://devcenter.kinvey.com/angular/guides/datastore">Kinvey Data Store</a> - implementation of <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a> pattern by MBaaS Kinvey, <a class="reference external" href="https://github.com/Kinvey/js-sdk/tree/master/src/datastore/src">source code</a></li>
<li><a class="reference external" href="https://github.com/vincentracine/pocketjs">Pocket.js</a> - a wrapper for the window.localStorage. It provides helpful methods which utilise MongoDB&#8217;s proven syntax and provides a powerful lightweight abstraction from the complexity of managing and querying local storage.</li>
</ul>
<p>Я хотел бы добавить сюда и <a class="reference external" href="https://emberjs.com/">Ember.js</a>, но он реализует паттерн <a class="reference external" href="http://www.martinfowler.com/eaaCatalog/activeRecord.html">ActiveRecord</a>.</p>
</div>
<div class="section" id="id9">
<h1><a class="toc-backref" href="#id47">Реализация реляционных связей</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id10">
<h2><a class="toc-backref" href="#id48">Синхронное программирование</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<p>На заре появления ORM, мапперы делали таким образом, чтобы они извлекали из базы данных все связанные объекты одним запросом (см. <a class="reference external" href="https://bitbucket.org/emacsway/openorm/src/default/python/">пример реализации</a>).</p>
<p>Domain-Driven Design подходит к связям более строго, и рассматривает связи с позиции концептуальных контуров агрегата вложенных объектов <a class="footnote-reference" href="#fnddd" id="id12">[4]</a>.
Доступ к объекту осуществлялся либо по ссылке (от родительского объекта к вложеному), либо через Repository.
Здесь также особую роль играет направление связей, и соблюдение принципа минимальной достаточности (&#8220;дистиляция моделей&#8221; <a class="footnote-reference" href="#fnddd" id="id13">[4]</a>).</p>
<blockquote>
<div><p>In real life, there are lots of many-to-many associations, and a great number are naturally
bidirectional. The same tends to be true of early forms of a model as we brainstorm and explore
the domain. But these general associations complicate implementation and maintenance.
Furthermore, they communicate very little about the nature of the relationship.</p>
<p>There are at least three ways of making associations more tractable.</p>
<ol class="arabic simple">
<li>Imposing a traversal direction</li>
<li>Adding a qualifier, effectively reducing multiplicity</li>
<li>Eliminating nonessential associations</li>
</ol>
<p>It is important to constrain relationships as much as possible. A bidirectional association means
that both objects can be understood only together. When application requirements do not call for
traversal in both directions, adding a traversal direction reduces interdependence and simplifies
the design. Understanding the domain may reveal a natural directional bias.
(«Domain-Driven Design: Tackling Complexity in the Heart of Software» <a class="footnote-reference" href="#fnddd" id="id14">[4]</a>)</p>
</div></blockquote>
<blockquote>
<div>Minimalist design of associations helps simplify traversal and limit the explosion of relationships
somewhat, but most business domains are so interconnected that we still end up tracing long,
deep paths through object references. In a way, this tangle reflects the realities of the world,
which seldom obliges us with sharp boundaries. It is a problem in a software design.
(«Domain-Driven Design: Tackling Complexity in the Heart of Software» <a class="footnote-reference" href="#fnddd" id="id15">[4]</a>)</div></blockquote>
<p>С появлением ORM, в синхронном программировании активно начали применяться ленивые вычисления для разрешения связей.
В Python для этого активно используются <a class="reference external" href="https://docs.python.org/3/howto/descriptor.html">Descriptors</a>, а в Java - AOP и Cross-Cutting Concerns <a class="footnote-reference" href="#fnccode" id="id16">[1]</a>.</p>
<p>Ключевым моментом является освобождение Domain Model от логики доступа к источнику данных.
Это необходимо как из принципа чистоты архитектуры и проектных решений, чтобы снизить сопряжение (<a class="reference external" href="http://wiki.c2.com/?CouplingAndCohesion">Coupling</a>), так и из принципа простоты тестирования.
Наибольших успехов позволяет достигнуть принцип Cross-Cutting Concerns, который полностью освобождает модель от служебной логики.</p>
<p>С появлением ОРМ, организация связей стала настолько легкой, что о ней перестали задумываться.
Там где требуются однонаправленные связи, разработчики с легкостью применяют двунаправленные связи.
Появились механизмы оптимизации выборки связанных объектов, которые неявно предзагружают все связанные объекты, что значительно сокращает количество обращений в базу данных.</p>
</div>
<div class="section" id="id17">
<h2><a class="toc-backref" href="#id49">Отказ от связей</a><a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h2>
<p>Стоит упомянуть и другую распространенную точку зрения, которая гласит, что объект не должен отвечать за свои связи, а исключительное право на доступ к объекту должно принадлежать только Repository.
Такой точки зрения придерживаются некоторые уважаемые мною друзья.</p>
</div>
<div class="section" id="id18">
<h2><a class="toc-backref" href="#id50">Асинхронное программирование</a><a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h2>
<p>Рост популярности асинхронных приложений заставил пересмотреть устоявшиеся представления о ленивой реализации связей.
Асинхронное обращение к каждой ленивой связи каждого объекта значительно усложняет ясность программного кода, и препятствует оптимизации.</p>
<p>Это привело к росту популярности объекто-ориентированных баз данных в асинхронном программировании, которые позволяют сохранять агрегаты целиком.
Все чаще REST-frameworks стали использоваться для передачи клиенту <a class="reference external" href="http://www.django-rest-framework.org/api-guide/serializers/#dealing-with-nested-objects">агрегатов вложенных объектов</a>.</p>
<blockquote>
<div><p>To do anything with an object, you have to hold a reference to it. How do you get that reference?
One way is to create the object, as the creation operation will return a reference to the new
object. A second way is to traverse an association. You start with an object you already know and
ask it for an associated object. Any object-oriented program is going to do a lot of this, and these
links give object models much of their expressive power. But you have to get that first object.</p>
<p>I actually encountered a project once in which the team was attempting, in an enthusiastic
embrace of MODEL-DRIVEN DESIGN , to do all object access by creation or traversal! Their objects
resided in an object database, and they reasoned that existing conceptual relationships would
provide all necessary associations. They needed only to analyze them enough, making their entire
domain model cohesive. This self-imposed limitation forced them to create just the kind of endless
tangle that we have been trying to avert over the last few chapters, with careful implementation of
ENTITIES and application of AGGREGATES . The team members didn&#8217;t stick with this strategy long, but
they never replaced it with another coherent approach. They cobbled together ad hoc solutions
and became less ambitious.</p>
<p>Few would even think of this approach, much less be tempted by it, because they store most oftheir objects in relational databases.
This storage technology makes it natural to use the third way
of getting a reference: Execute a query to find the object in a database based on its attributes, or
find the constituents of an object and then reconstitute it.
(«Domain-Driven Design: Tackling Complexity in the Heart of Software» <a class="footnote-reference" href="#fnddd" id="id20">[4]</a>)</p>
</div></blockquote>
<p>Необходимость обхода агрегатов активизировала интерес к функциональному программированию, особенно в сочетании с парадигмой реактивного программирования.</p>
<p>Однако, решение одной проблемы порождало другую проблему.</p>
</div>
<div class="section" id="id21">
<h2><a class="toc-backref" href="#id51">Функциональное программирование</a><a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h2>
<p>Функциональное программирование сложнее использовать для объектов предметной области, так как его сложнее структурировать логически (особенно при отсутствии поддержки <a class="reference external" href="https://ru.wikipedia.org/wiki/%D0%9C%D1%83%D0%BB%D1%8C%D1%82%D0%B8%D0%BC%D0%B5%D1%82%D0%BE%D0%B4">множественной диспетчеризации</a>), что зачастую приводит к появлению плохо читаемого кода, который выражает не то, &#8220;что&#8221; он делает, а то, &#8220;как&#8221; он делает непонятно что.</p>
<blockquote>
<div><p>If you wanted polymophism in C, you’d have to manage those pointers yourself;
and that’s hard. If you wanted polymorphism in Lisp you’d have to manage those pointers yourself (pass them in as arguments to some higher level algorithm (which, by the way IS the Strategy pattern.))
But in an OO language, those pointers are managed for you.
The language takes care to initialize them, and marshal them, and call all the functions through them.</p>
<p>... There really is only one benefit to Polymorphism; but it’s a big one. It is the inversion of source code and run time dependencies.
(«OO vs FP» <a class="footnote-reference" href="#fnoovsop" id="id22">[7]</a>)</p>
</div></blockquote>
<blockquote>
<div><p>Все же мой опыт подсказывает
мне, что стоимость изменений увеличивается в большей степени в случае,
если вы не используете объекты, чем в случае, если вы основываете
свой проект на объектно-ориентированном подходе.</p>
<p>However, my experience is that the cost of change rises
more steeply without objects than with objects.
(Kent Beck <a class="footnote-reference" href="#fnxp" id="id23">[10]</a>)</p>
</div></blockquote>
<p>А между тем, неясность намерений и целей автора - это ключевая проблема при чтении чужого кода.</p>
<blockquote>
<div><p>Шестимесячное исследование, проведенное в IBM, показало, что программисты,
отвечавшие за сопровождение программы, «чаще всего говорили, что
труднее всего было понять цель автора кода» (Fjelstad and Hamlen, 1979).</p>
<p>A six-month study
conducted by IBM found that maintenance programmers &#8220;most
often said that understanding the original programmer&#8217;s intent was
the most difficult problem&#8221; (Fjelstad and Hamlen 1979).
(«Code Complete» <a class="footnote-reference" href="#fncodec" id="id24">[2]</a>)</p>
</div></blockquote>
<p>Как упоминалось в статье &#8220;<a class="reference internal" href="../../en/how-to-quickly-develop-high-quality-code/"><span class="doc">How to quickly develop high-quality code. Team work.</span></a>&#8221;, в процессе конструирования кода разработчик 91% времени читает код, и только 9% времени он вводит символы с клавиатуры.
А это значит, что плохо читаемый код на 91% влияет на темпы разработки.</p>
<p>Также такой подход разрушает все выгоды использования Domain-Driven Design, и разделяет элементы, реализующие концептуальные объекты, которые оказываются физически разделенными, что приводит к появлению кода, который больше не выражает модель.</p>
<p>Все <a class="reference external" href="https://groups.google.com/d/msg/reactjs/jbh50-GJxpg/82CHQKeaG54J">это способствовало появлению</a> в сообществе ReactJS таких библиотек как:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/paularmstrong/normalizr">Normalizr</a> - Normalizes (decomposes) nested JSON according to a schema.</li>
<li><a class="reference external" href="https://github.com/gpbl/denormalizr">Denormalizr</a> - Denormalize data normalized with normalizr.</li>
</ul>
</div>
<div class="section" id="id25">
<h2><a class="toc-backref" href="#id52">Лирическое отступление</a><a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h2>
<p>Несмотря на то, что приемы функционального программирования часто используются совместно с парадигмой реактивного программирования, в своей сути эти парадигмы не всегда сочетаемы в каноническом виде в веб-разработке.</p>
<p>Это потому, что реактивное программирование основано на распространении изменений, т.е. подразумевает наличие переменных и присваивания.</p>
<blockquote>
<div><p>Это означает, что должна существовать возможность легко выражать статические и динамические потоки данных, а также то, что нижележащая модель исполнения должна автоматически распространять изменения благодаря потоку данных.</p>
<p>К примеру, в императивном программировании присваивание a := b + c будет означать, что переменной a будет присвоен результат выполнения операции b + c, используя текущие (на момент вычисления) значения переменных.
Позже значения переменных b и c могут быть изменены без какого-либо влияния на значение переменной a.
В реактивном же программировании значение a будет автоматически пересчитано, основываясь на новых значениях.</p>
<p>... К примеру, в MVC архитектуре с помощью реактивного программирования можно реализовать автоматическое отражение изменений из Model в View и наоборот из View в Model.</p>
<p>This means that it becomes possible to express static (e.g. arrays) or dynamic (e.g. event emitters) data streams with ease via the employed programming language(s), and that an inferred dependency within the associated execution model exists, which facilitates the automatic propagation of the change involved with data flow.</p>
<p>For example, in an imperative programming setting, <code class="docutils literal"><span class="pre">a</span> <span class="pre">:=</span> <span class="pre">b</span> <span class="pre">+</span> <span class="pre">c</span></code> would mean that <code class="docutils literal"><span class="pre">a</span></code> is being assigned the result of <code class="docutils literal"><span class="pre">b</span> <span class="pre">+</span> <span class="pre">c</span></code> in the instant the expression is evaluated, and later, the values of <code class="docutils literal"><span class="pre">b</span></code> and/or <code class="docutils literal"><span class="pre">c</span></code> can be changed with no effect on the value of <code class="docutils literal"><span class="pre">a</span></code>.
However, in reactive programming, the value of <code class="docutils literal"><span class="pre">a</span></code> is automatically updated whenever the values of <code class="docutils literal"><span class="pre">b</span></code> and/or <code class="docutils literal"><span class="pre">c</span></code> change;
without the program having to re-execute the sentence <code class="docutils literal"><span class="pre">a</span> <span class="pre">:=</span> <span class="pre">b</span> <span class="pre">+</span> <span class="pre">c</span></code> to determine the presently assigned value of <code class="docutils literal"><span class="pre">a</span></code>.</p>
<p>... For example, in an model–view–controller (MVC) architecture, reactive programming can facilitate changes in an underlying model that automatically are reflected in an associated view, and contrarily.
(&#8220;<a class="reference external" href="https://en.wikipedia.org/wiki/Reactive_programming">Reactive programming</a>&#8221;, wikipedia)</p>
</div></blockquote>
<p>Именно поэтому парадигма реактивного программирования <a class="reference external" href="https://en.wikipedia.org/wiki/Reactive_programming#Approaches">может сочетаться с различными парадигмами</a>, императивной, объектно-ориентированной и функциональной.</p>
<p>Однако, вся суть вопроса заключается в том, что в каноническом виде функциональное программирование не имеет переменных (от слова &#8220;переменчивость&#8221;, изменяемость). т.е. изменяемого состояния:</p>
<blockquote>
<div><p>A true functional programming language has no assignment operator.
You cannot change the state of a variable.
Indeed, the word “variable” is a misnomer in a functional language because you cannot vary them.</p>
<p>...The overriding difference between a functional language and a non-functional language is that functional languages don’t have assignment statements.</p>
<p>... The point is that a functional language imposes some kind of ceremony or discipline on changes of state. You have to jump through the right hoops in order to do it.</p>
<p>And so, for the most part, you don’t.
(«OO vs FP» <a class="footnote-reference" href="#fnoovsop" id="id26">[7]</a>)</p>
</div></blockquote>
<p>Поэтому, использование подходов функционального программирования не делает программу функциональной до тех пор, пока программа имеет изменяемое состояние, - это просто процедурное программирование.
А если это так, то отказ от Domain-Driven Design просто отнимает превосходства обоих подходов (ни полиморфизма объектно-ориентированного программирования, ни неизменяемости функционального программирования), объединяя все худшее, подобно объектам-гибридам <a class="footnote-reference" href="#fnccode" id="id27">[1]</a>, так и не делая программу по настоящему функциональной.</p>
<blockquote>
<div><p>Гибриды</p>
<p>Вся эта неразбериха иногда приводит к появлению гибридных структур —
наполовину объектов, наполовину структур данных. Гибриды содержат как функции
для выполнения важных операций, так и открытые переменные или открытые
методы чтения/записи, которые во всех отношениях делают приватные
переменные открытыми. Другим внешним функциям предлагается использовать эти
переменные так, как в процедурных программах используются структуры данных
(иногда это называется «функциональной завистью» (Feature Envy) — из &#8220;Refactoring&#8221; <a class="footnote-reference" href="#fnrefactoring" id="id28">[6]</a>).
Подобные гибриды усложняют как добавление новых функций, так и новых
структур данных. Они объединяют все худшее из обеих категорий. Не
используйте гибриды. Они являются признаком сумбурного проектирования, авторы
которого не уверены (или еще хуже, не знают), что они собираются защищать:
функции или типы.</p>
<p>Hybrids</p>
<p>This confusion sometimes leads to unfortunate hybrid structures that are half object and
half data structure. They have functions that do significant things, and they also have either
public variables or public accessors and mutators that, for all intents and purposes, make
the private variables public, tempting other external functions to use those variables the
way a procedural program would use a data structure (this is sometimes called Feature Envy from &#8220;Refactoring&#8221; <a class="footnote-reference" href="#fnrefactoring" id="id29">[6]</a>).
Such hybrids make it hard to add new functions but also make it hard to add new data
structures. They are the worst of both worlds. Avoid creating them. They are indicative of a
muddled design whose authors are unsure of—or worse, ignorant of—whether they need
protection from functions or types.
(«Clean Code: A Handbook of Agile Software Craftsmanship» <a class="footnote-reference" href="#fnccode" id="id30">[1]</a>)</p>
</div></blockquote>
<p>Каноническое функциональное программирование не имеет состояния, и поэтому идеально подходит для распределенных вычислений и обработки потоков данных.</p>
<blockquote>
<div><p>The benefit of not using assignment statements should be obvious.
You can’t have concurrent update problems if you never update anything.</p>
<p>Since functional programming languages do not have assignment statements, programs written in those languages don’t change the state of very many variables.
Mutation is reserved for very specific sections of the system that can tolerate the high ceremony required.
Those sections are inherently safe from multiple threads and multiple cores.</p>
<p>The bottom line is that functional programs are much safer in multiprocessing and multiprocessor environments.
(«OO vs FP» <a class="footnote-reference" href="#fnoovsop" id="id31">[7]</a>)</p>
</div></blockquote>
<p>Но значит ли это то, что парадигма объектно-ориентированного программирования противостоит парадигме функционального программирования?</p>
<p>Несмотря на то, что парадигма ООП традиционно считается разновидностью императивной парадигмы, т.е. основанной на состоянии программы, Robert C. Martin делает поразительный вывод - так как объекты предоставляют свой интерфейс, т.е. поведение, и скрывают свое состояние, то они не противоречат парадигме функционального программирования.</p>
<blockquote>
<div>&#8220;Objects are not data structures.
Objects may use data structures; but the manner in which those data structures are used or contained is hidden.
This is why data fields are private.
From the outside looking in you cannot see any state.
All you can see are functions.
Therefore Objects are about functions not about state.&#8221;
(«OO vs FP» <a class="footnote-reference" href="#fnoovsop" id="id32">[7]</a>)</div></blockquote>
<p>Поэтому некоторые классические функциональные языки программирования имеют поддержку ООП:</p>
<ul>
<li><p class="first"><a class="reference external" href="https://www.gnu.org/software/emacs/manual/html_mono/eieio.html">Enhanced Implementation of Emacs Interpreted Objects</a></p>
</li>
<li><p class="first"><a class="reference external" href="https://en.wikipedia.org/wiki/Common_Lisp_Object_System">Common Lisp Object System</a></p>
<blockquote>
<div><p>Are these two disciplines mutually exclusive?
Can you have a language that imposes discipline on both assignment and pointers to functions?
Of course you can.
These two things don’t have anything to do with each other.
And that means that OO and FP are not mutually exclusive at all.
It means that you can write OO-Functional programs.</p>
<p>It also means that all the design principles, and design patterns, used by OO programmers can be used by functional programmers if they care to accept the discipline that OO imposes on their pointers to functions.
(«OO vs FP» <a class="footnote-reference" href="#fnoovsop" id="id33">[7]</a>)</p>
</div></blockquote>
</li>
</ul>
<p>Разумеется, объекты в функциональном программировании <a class="reference external" href="https://youtu.be/7Zlp9rKHGD4?t=50m">должны быть неизменяемым</a>.</p>
<p>Эмулировать объекты можно даже в функциональных языках программирования с помощью замыканий, см. статью &#8220;<a class="reference external" href="https://martinfowler.com/bliki/FunctionAsObject.html">Function As Object</a>&#8221; by Martin Fowler.
Тут нельзя обойти вниманием замечательную книгу &#8220;<a class="reference external" href="https://leanpub.com/fp-oo">Functional Programming for the Object-Oriented Programmer</a>&#8221; by Brian Marick.</p>
<p>Давайте вспомним главу &#8220;Chapter 6. Working Classes: 6.1. Class Foundations: Abstract Data Types (ADTs): Handling Multiple Instances of Data with ADTs in Non-Object-Oriented Environments&#8221; книги «Code Complete» <a class="footnote-reference" href="#fncodec" id="id34">[2]</a>.</p>
<blockquote>
<div><p>Абстрактный тип данных (АТД) — это набор, включающий данные и выполняемые над ними операции.</p>
<p>An abstract data type is a collection of data and operations that work on that data.
(«Code Complete» <a class="footnote-reference" href="#fncodec" id="id35">[2]</a>)</p>
</div></blockquote>
<blockquote>
<div><p>Абстрактные типы данных лежат в основе концепции классов.</p>
<p>Abstract data types form the foundation for the concept of classes.
(«Code Complete» <a class="footnote-reference" href="#fncodec" id="id36">[2]</a>)</p>
</div></blockquote>
<blockquote>
<div><p>Размышление в первую очередь об АТД (Абстрактный Тип Данных) и только во вторую о классах является примером программирования с использованием языка в отличии от программирования на языке.</p>
<p>Thinking about ADTs first and classes second is an example of programming into a language vs. programming in one.
(«Code Complete» <a class="footnote-reference" href="#fncodec" id="id37">[2]</a>)</p>
</div></blockquote>
<p>Я не буду переписывать сюда достоинства АТД, их можно прочитать в указанной главе этой книги.</p>
<p>Но ведь изначально вопрос состоял в том, стоит ли отказываться от АТД в объектно-ориентированном языке при проектировании объектов предметной области в пользу &#8220;<a class="reference external" href="http://www.martinfowler.com/bliki/AnemicDomainModel.html">Anemic Domain Model</a>&#8221;, и стоит ли приносить в жертву все выгоды Domain-Driven Design в угоду удобства конкретной реализации обработки связей?</p>
<p>Объектно-ориентированная <a class="reference external" href="https://youtu.be/TMuno5RZNeE?t=33m30s">модель полиморфизма осуществляет одну важную вещь - внедрение зависимостей</a>.
При отказе от объектно-ориентированной модели, вопрос внедрения зависимостей остается открытым.</p>
<blockquote>
<div>The bottom, bottom line here is simply this.
OO programming is good, when you know what it is.
Functional programming is good when you know what it is.
And functional OO programming is also good once you know what it is.
(«OO vs FP» <a class="footnote-reference" href="#fnoovsop" id="id38">[7]</a>)</div></blockquote>
<p>Также стоит отметить, что далеко не все виды связей вписываются в концепцию агрегата.
Если объект логически не принадлежит агрегату, то мы не можем вкладывать его в агрегат ради удобства разрешения связей, ибо в таком случае у нас интерфейс будет следовать за реализацией что в корне разрушает фундаментальный принцип абстракции.
Также агрегат не совместим со связями типа Many-To-Many и перекрестными иерархиями связей.</p>
</div>
<div class="section" id="id39">
<h2><a class="toc-backref" href="#id53">Реализация связей путем присваивания</a><a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h2>
<p>Принцип физического присваивания связанных объектов <a class="reference external" href="http://www.js-data.io/v3.0/docs/relations#section-eagerly-loading-relations">реализован также и в библиотеке js-data</a>.</p>
<p>В нашей библиотеке мы предусмотрели как возможность декомпозиции агрегатов вложенных объектов, так и возможность их композиции из плоских данных в Repositories.
Причем, агрегат всегда сохраняет актуальное состояние, и при добавлении, изменении, удалении объекта в Repository, изменения автоматически отображаются в структурах соответствующих агрегатов.
Библиотека реализует это поведение как в парадигме Реактивного программирования, так и в парадигме Событийно-ориентированного программирования (на выбор).</p>
<p>Существует также возможность формировать двусторонние связи.
Но, несмотря на то, что современные интерпретаторы легко чистят мусор с кольцевыми ссылками, с концептуальной точки зрения лучше когда вложенные объекты не осведомлены о своем родителе, если на то нет веских оснований.</p>
<p>Таким образом, для реализации связей объекту совершенно не требуется никакая служебная логика доступа к данным, что поддерживает нулевое сопряжение (<a class="reference external" href="http://wiki.c2.com/?CouplingAndCohesion">Coupling</a>) и образует кристально чистые доменные модели.
Это значит, что доменные модели могут быть инстанцией &#8220;класса&#8221; Object.</p>
<p>Я также учел точку зрения, что доменная модель не должна отвечать за связи.
Поэтому предусмотрена возможность легкого доступа к любому объекту через его Repository.</p>
</div>
</div>
<div class="section" id="id40">
<h1><a class="toc-backref" href="#id54">Исходный код</a><a class="headerlink" href="#id40" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>Edge (unstable) repo - <a class="reference external" href="https://github.com/emacsway/store">https://github.com/emacsway/store</a></li>
<li>Canonical repo - <a class="reference external" href="https://github.com/joor/store-js-external">https://github.com/joor/store-js-external</a></li>
</ul>
<p>This article in English &#8220;<a class="reference internal" href="../../en/javascript-and-repository-pattern/"><span class="doc">Implementation of Repository pattern for browser&#8217;s JavaScript</span></a>&#8221;.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="fnccode" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td><em>(<a class="fn-backref" href="#id2">1</a>, <a class="fn-backref" href="#id16">2</a>, <a class="fn-backref" href="#id27">3</a>, <a class="fn-backref" href="#id30">4</a>)</em> «<a class="reference external" href="http://www.informit.com/store/clean-code-a-handbook-of-agile-software-craftsmanship-9780132350884">Clean Code: A Handbook of Agile Software Craftsmanship</a>» by <a class="reference external" href="http://informit.com/martinseries">Robert C. Martin</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fncodec" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[2]</td><td><em>(<a class="fn-backref" href="#id24">1</a>, <a class="fn-backref" href="#id34">2</a>, <a class="fn-backref" href="#id35">3</a>, <a class="fn-backref" href="#id36">4</a>, <a class="fn-backref" href="#id37">5</a>)</em> «<a class="reference external" href="http://www.informit.com/store/code-complete-9780735619678">Code Complete</a>» Steve McConnell</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnpoeaa" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[3]</td><td>«<a class="reference external" href="https://www.martinfowler.com/books/eaa.html">Patterns of Enterprise Application Architecture</a>» by <a class="reference external" href="https://martinfowler.com/aboutMe.html">Martin Fowler</a>, David Rice, Matthew Foemmel, Edward Hieatt, Robert Mee, Randy Stafford</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnddd" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[4]</td><td><em>(<a class="fn-backref" href="#id4">1</a>, <a class="fn-backref" href="#id7">2</a>, <a class="fn-backref" href="#id12">3</a>, <a class="fn-backref" href="#id13">4</a>, <a class="fn-backref" href="#id14">5</a>, <a class="fn-backref" href="#id15">6</a>, <a class="fn-backref" href="#id20">7</a>)</em> «Domain-Driven Design: Tackling Complexity in the Heart of Software» by Eric Evans</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fngof" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[5]</td><td>«Design Patterns Elements of Reusable Object-Oriented Software» by Erich Gamma, Richard Helm, Ralph Johnson, John Vlissides, 1994</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnrefactoring" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[6]</td><td><em>(<a class="fn-backref" href="#id5">1</a>, <a class="fn-backref" href="#id28">2</a>, <a class="fn-backref" href="#id29">3</a>)</em> «<a class="reference external" href="https://martinfowler.com/books/refactoring.html">Refactoring: Improving the Design of Existing Code</a>» by <a class="reference external" href="https://martinfowler.com/aboutMe.html">Martin Fowler</a>, Kent Beck, John Brant, William Opdyke, Don Roberts</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnoovsop" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[7]</td><td><em>(<a class="fn-backref" href="#id22">1</a>, <a class="fn-backref" href="#id26">2</a>, <a class="fn-backref" href="#id31">3</a>, <a class="fn-backref" href="#id32">4</a>, <a class="fn-backref" href="#id33">5</a>, <a class="fn-backref" href="#id38">6</a>)</em> «<a class="reference external" href="http://blog.cleancoder.com/uncle-bob/2014/11/24/FPvsOO.html">OO vs FP</a>» by Robert C. Martin</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnca" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[8]</td><td>«<a class="reference external" href="https://8thlight.com/blog/uncle-bob/2011/11/22/Clean-Architecture.html">Clean Architecture</a>» by Robert C. Martin</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fntca" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[9]</td><td>«<a class="reference external" href="https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html">The Clean Architecture</a>» by Robert C. Martin</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnxp" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[10]</td><td><em>(<a class="fn-backref" href="#id3">1</a>, <a class="fn-backref" href="#id6">2</a>, <a class="fn-backref" href="#id23">3</a>)</em> «<a class="reference external" href="http://www.informit.com/store/extreme-programming-explained-embrace-change-9780321278654">Extreme Programming Explained</a>» by Kent Beck</td></tr>
</tbody>
</table>
<div class="note update admonition">
<p class="first last admonition-title">Updated on Nov 27, 2017</p>
</div>
</div>

  <div class="section">
  
    


<div class="section">
  <span style="float: left;">
  
  
  <a href="../../en/javascript-and-repository-pattern/">
    <i class="fa fa-arrow-circle-left"></i>
    Implementation of Repository pattern for browser's JavaScript
  </a>
  
  </span>
  <span>&nbsp;</span>
  <span style="float: right;">
  
  
  <a href="../about-quality-of-comments/">
    О качестве комментариев в интернете
    <i class="fa fa-arrow-circle-right"></i>
  </a>
  </span>
  
</div>

  
  
    <div class="section">
    <h2>Comments</h2>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'emacsway';
        var disqus_identifier = '/ru/javascript-and-repository-pattern/';
        var disqus_title = 'Реализация паттерна Repository в браузерном JavaScript';
        var disqus_url = 'https://emacsway.github.io/ru/javascript-and-repository-pattern/';

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  
  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../">
    <img class="logo" src="../../_static/logo.jpg" alt="Logo"/>
    
    <h1 class="logo logo-name">@emacsway's blog</h1>
    
  </a>
</p>









  
  
  <h2>
  
  <i class="fa fa-calendar"></i>
    Aug 06, 2017
  
  </h2>

  <ul>
    
  <li><i class="fa fa-pencil-square-o"></i>
    Nov 27, 2017</li>
  

  
  <li><i class="fa-fw fa fa-user"></i>
    
      
      <a href="../../blog/author/ivan-zakrevsky/">Ivan Zakrevsky</a>
      
    </li>
  

  

  
  <li><i class="fa-fw fa fa-language"></i>
    
      
      <a href="../../blog/language/russian/">Russian</a>
      
    </li>
  

  

  
  <li><i class="fa-fw fa fa-tags"></i>
      
    
      
      <a href="../../blog/tag/repository/">Repository</a>,
      
    
      
      <a href="../../blog/tag/orm/">ORM</a>,
      
    
      
      <a href="../../blog/tag/javascript/">JavaScript</a>,
      
    
      
      <a href="../../blog/tag/model/">Model</a>,
      
    
      
      <a href="../../blog/tag/ddd/">DDD</a>
      
    </li>
  
  
  <li>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'emacsway'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
    <i class="fa-fw fa fa-comments"></i>
    <a href="#disqus_thread" data-disqus-identifier="/ru/javascript-and-repository-pattern/"> </a>
  </li>
  
  </ul>


<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about/">About me</a></li>
</ul>


  <h3><a href="../../blog/">Recent Posts</a></h3>
  <ul>
    
    
      <li><a href="../about-quality-of-comments/">Aug 13 - О качестве комментариев в интернете</a></li>
    
      <li><a href="../../en/javascript-and-repository-pattern/">Aug 06 - Implementation of Repository pattern for browser's JavaScript</a></li>
    
      <li><a href="../django-framework/">Jul 26 - О моем опыте использования Django Framework</a></li>
    
      <li><a href="../../en/django-framework/">Jul 26 - About my experience of using Django Framework</a></li>
    
      <li><a href="../service-layer/">Jul 17 - Проектирование Сервисного Слоя</a></li>
    
  </ul>

  <h3><a href="../../blog/tag/">Tags</a></h3>
  <style type="text/css">
    ul.ablog-cloud {list-style: none; overflow: auto;}
    ul.ablog-cloud li {float: left; height: 20pt; line-height: 18pt; margin-right: 5px;}
    ul.ablog-cloud a {text-decoration: none; vertical-align: middle;}
    li.ablog-cloud-1{font-size: 80%;}
    li.ablog-cloud-2{font-size: 95%;}
    li.ablog-cloud-3{font-size: 110%;}
    li.ablog-cloud-4{font-size: 125%;}
    li.ablog-cloud-5{font-size: 140%;}
  </style>
  <ul class="ablog-cloud">
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/architecture/">Architecture</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/db/">DB</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/ddd/">DDD</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/datamapper/">DataMapper</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/dependency-injection/">Dependency Injection</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/design/">Design</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/django/">Django</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-3">
        <a href="../../blog/tag/django-model/">Django Model</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/emacs/">Emacs</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/fowler/">Fowler</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/javascript/">JavaScript</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/model/">Model</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-5">
        <a href="../../blog/tag/orm/">ORM</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-5">
        <a href="../../blog/tag/python/">Python</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/repository/">Repository</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/sql/">SQL</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/storm-orm/">Storm ORM</a></li>
      
    
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/autocomplete/">autocomplete</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/cache/">cache</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/programming/">programming</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/refactoring/">refactoring</a></li>
      
    
  </ul>

  <h3><a href="../../blog/archive/">Archives</a></h3>
  <ul>
  
    
    <li><a href="../../blog/2017/">2017 (8)</a></li>
    
  
    
    <li><a href="../../blog/2016/">2016 (5)</a></li>
    
  
    
    <li><a href="../../blog/2015/">2015 (6)</a></li>
    
  
  </ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

    <div class="footer">
      &copy;2017, Ivan Zakrevsky.
      
      |
      Powered by <a href="http://ablog.readthedocs.org/">ABlog</a> &amp; <a href="http://sphinx-doc.org/">Sphinx 1.4.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
      |
      <a href="../../_sources/ru/javascript-and-repository-pattern.txt"
          rel="nofollow">Page source</a>
    </div>

    

    


    

        <!-- Go to www.addthis.com/dashboard to customize your tools -->
        <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-597ba7fb5af2ef1e"></script>

    


<!-- google.com/analytics counter -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-69288289-1', 'auto');
  ga('send', 'pageview');

</script>
<!-- /google.com/analytics counter -->


<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function (d, w, c) {
        (w[c] = w[c] || []).push(function() {
            try {
                w.yaCounter32948409 = new Ya.Metrika({
                    id:32948409,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true
                });
            } catch(e) { }
        });

        var n = d.getElementsByTagName("script")[0],
            s = d.createElement("script"),
            f = function () { n.parentNode.insertBefore(s, n); };
        s.type = "text/javascript";
        s.async = true;
        s.src = "https://mc.yandex.ru/metrika/watch.js";

        if (w.opera == "[object Opera]") {
            d.addEventListener("DOMContentLoaded", f, false);
        } else { f(); }
    })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/32948409" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->



  </body>
</html>
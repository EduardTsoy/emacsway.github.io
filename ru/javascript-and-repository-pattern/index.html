<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Реализация паттерна Repository в браузерном JavaScript &mdash; @emacsway&#39;s blog</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/jquery-toast-plugin/jquery.toast.min.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/jquery-toast-plugin/jquery.toast.min.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="@emacsway&#39;s blog" href="../../" />
  

   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />


    

        <meta http-equiv="Last-Modified" content="Sat, 26 May 2018 00:00:00 GMT" />
        
            <meta name="description" content="Хорошая архитектура освобождает Вас от привязки к конкретной реализации. Она позволяет Вам отложить момент принятия решения о реализации, и начать конструирование кода еще не имея этого решения. Принципиально важным моментом является то, что Вы обретаете возможность принять решение в момент наибольшей информированности, а также всегда можете легко подменить конкретную реализацию на любую другую. Вот эта обязанность возложена на паттерн Repository." />
        
        
            <meta property="og:image" content="../../_static/logo.jpg" />
            <link rel="image_src" href="../../_static/logo.jpg" />
        

        <link rel="canonical" href="https://emacsway.github.io/ru/javascript-and-repository-pattern/" />

        <script type="text/javascript">
            setTimeout(function() {
                $.toast({
                    text: 'If you like this site, please support it with an external link or share it with an social nerwork. Thanks!',
                    position: 'bottom-right',
                    hideAfter: 7000
                });
            }, 30000);
        </script>

    


  
  <link rel="alternate" type="application/atom+xml"  href="../../blog/atom.xml" title="@emacsway's blog">
  
  
  <link href="True" rel="stylesheet">
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.postlist a {font-style: italic;}
    ul.postlist-style-disc {list-style-type: disc;}
    ul.postlist-style-none {list-style-type: none;}
    ul.postlist-style-circle {list-style-type: circle;}
  </style>

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="repository-javascript">
<h1><a class="toc-backref" href="#id28">Реализация паттерна Repository в браузерном JavaScript</a><a class="headerlink" href="#repository-javascript" title="Permalink to this headline">¶</a></h1>
<p>Хорошая архитектура освобождает Вас от привязки к конкретной реализации.
Она позволяет Вам отложить момент принятия решения о реализации, и <a class="reference external" href="http://martinfowler.com/eaaCatalog/serviceStub.html">начать конструирование кода еще не имея этого решения</a>.
Принципиально важным моментом является то, что Вы обретаете возможность принять решение в момент наибольшей информированности, а также всегда можете легко подменить конкретную реализацию на любую другую.
Вот эта обязанность возложена на паттерн <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a>.</p>
<div class="contents topic" id="id1">
<p class="topic-title first">Содержание</p>
<ul class="simple">
<li><a class="reference internal" href="#repository-javascript" id="id28">Реализация паттерна Repository в браузерном JavaScript</a></li>
<li><a class="reference internal" href="#domain-model" id="id29">Модель предметной области (Domain Model)</a></li>
<li><a class="reference internal" href="#id8" id="id30">Парадигма реактивного программирования</a></li>
<li><a class="reference internal" href="#repository-orm-javascript" id="id31">Примеры реализаций паттерна Repository и ORM в JavaScript</a></li>
<li><a class="reference internal" href="#id9" id="id32">Реализация реляционных связей</a><ul>
<li><a class="reference internal" href="#id10" id="id33">Синхронное программирование</a></li>
<li><a class="reference internal" href="#id17" id="id34">Асинхронное программирование</a></li>
<li><a class="reference internal" href="#id20" id="id35">Реализация связей путем присваивания</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id25" id="id36">Исходный код</a></li>
</ul>
</div>
<p>Таким образом, у Вас появляется полная абстракция от источника данных, будь то REST-API, MBaaS, SaaS, IndexedDB, HTML, сторонний сервис по протоколу JSON-RPC или <a class="reference external" href="http://martinfowler.com/eaaCatalog/serviceStub.html">Service Stub</a>.</p>
<blockquote>
<div><p>&#8220;Однако мы часто забываем, что принятие решений лучше всего откладывать до последнего момента.
Дело не в лени или безответственности;
просто это позволяет принять информированное решение с максимумом возможной информации.
Преждевременное решение принимается на базе неполной информации.
Принимая решение слишком рано, мы лишаемся всего полезного, что происходит на более поздних стадиях:
обратной связи от клиентов, возможности поразмышлять над текущим состоянием проекта и опыта применения решений из области реализации.&#8221;</p>
<p>&#8220;We often forget that it is also best to postpone decisions until the last possible moment.
This isn’t lazy or irresponsible; it lets us make informed choices with the best possible information.
A premature decision is a decision made with suboptimal knowledge. We will have that
much less customer feedback, mental reflection on the project, and experience with our
implementation choices if we decide too soon.&#8221;</p>
<p>- &#8220;Clean Code: A Handbook of Agile Software Craftsmanship&#8221; <a class="footnote-reference" href="#fnccode" id="id2">[1]</a></p>
</div></blockquote>
<blockquote>
<div>&#8220;A good architecture allows major decision to be deferred!&#8221;
- <a class="reference external" href="https://youtu.be/Nltqi7ODZTM?t=19m40s">Robert Martin</a></div></blockquote>
<blockquote>
<div><p>&#8220;Вы получаете возможность принимать важные решения настолько поздно,
насколько это возможно.
Это делается для того, чтобы осуществлять связанные с этим
затраты как можно позже.
Кроме того, если вы откладываете решение важных вопросов на более
поздний срок, тем самым вы повышаете вероятность того,
что выбранное вами решение окажется правильным. Другими
словами, сегодня вы должны реализовать только то, без чего сегодня не
обойтись, при этом вы можете рассчитывать на то, что проблемы, решение
которых вы отложили до завтра, развеются сами собой, то есть перестанут
быть актуальными.&#8221;</p>
<p>&#8220;You would make big decisions as
late in the process as possible, to defer the cost of making the decisions and to have
the greatest possible chance that they would be right. You would only implement
what you had to, in hopes that the needs you anticipate for tomorrow wouldn&#8217;t come
true.&#8221;</p>
<p>- Kent Beck <a class="footnote-reference" href="#fnxp" id="id3">[11]</a></p>
</div></blockquote>
<blockquote>
<div>&#8220;The best architects remove architecture by figuring out how to make things shiftable.&#8221;
- <a class="reference external" href="https://youtu.be/VjKYO6DP3fo?t=17m59s">Martin Fowler</a></div></blockquote>
<p>Кроме того, у Вас появляется возможность реализовать паттерны <a class="reference external" href="http://martinfowler.com/eaaCatalog/identityMap.html">Identity Map</a> и <a class="reference external" href="http://martinfowler.com/eaaCatalog/unitOfWork.html">Unit of Work</a>.
Последний часто востребован, так как позволяет выполнить откат состояния локальных объектов в случае, если сохранить данные невозможно (пользователь передумал или ввел невалидные данные).</p>
</div>
<div class="section" id="domain-model">
<h1><a class="toc-backref" href="#id29">Модель предметной области (Domain Model)</a><a class="headerlink" href="#domain-model" title="Permalink to this headline">¶</a></h1>
<p>Наибольшим преимуществом полноценных <a class="reference external" href="http://martinfowler.com/eaaCatalog/domainModel.html">Моделей предметной области</a> в программе является возможность использования принципов Domain-Driven Design (DDD) <a class="footnote-reference" href="#fnddd" id="id4">[4]</a>.
Если Модели содержат исключительно бизнес-логику, и освобождены от служебной логики, то они могут легко читаться специалистами предметной области (т.е. представителем заказчика).
Это освобождает Вас от необходимости создания UML-диаграмм для обсуждений и позволяет добиться максимально высокого уровня взаимопонимания, продуктивности, и качества реализации моделей.</p>
<p>В одном из проектов я пытался реализовать достаточно сложную доменную логику (которая содержала более 30 взаимосвязанных доменных Моделей) в парадигме реактивного программирования с push-алгоритмом, когда атрибуты экземпляра Модели, содержащие аннотации агрегации или зависимые от них, изменяли свое значение путем реакции на изменения других моделей и хранилищ.
Суть в том, что вся эта реактивная логика уже не принадлежала самой доменной модели, и располагалась в разного рода <a class="reference external" href="https://en.wikipedia.org/wiki/Observer_pattern">слушателях</a> и обработчиках.</p>
<blockquote>
<div><p>&#8220;Весь смысл объектов в том, что они позволяют хранить данные вместе с процедурами их обработки.
Классический пример дурного запаха – метод, который больше интересуется не тем классом, в котором он находится, а каким то другим.
Чаще всего предметом зависти являются данные.&#8221;</p>
<p>&#8220;The whole point of objects is that they are a technique to package data with the processes used
on that data. A classic smell is a method that seems more interested in a class other than the one
it actually is in. The most common focus of the envy is the data.&#8221;</p>
<p>- &#8220;Refactoring: Improving the Design of Existing Code&#8221; <a class="footnote-reference" href="#fnrefactoring" id="id5">[7]</a></p>
</div></blockquote>
<blockquote>
<div><p>&#8220;Хороший дизайн размещает логику рядом с данными, в отношении которых она действует.&#8221;</p>
<p>&#8220;Good design puts the logic near the data it operates on.&#8221;</p>
<p>- Kent Beck <a class="footnote-reference" href="#fnxp" id="id6">[11]</a></p>
</div></blockquote>
<blockquote>
<div><p>&#8220;Если требования архитектурной среды к распределению обязанностей таковы, что элементы, реализующие концептуальные объекты, оказываются физически разделенными, то код больше не выражает модель.</p>
<p>Нельзя разделять до бесконечности, у человеческого ума есть свои пределы, до которых он еще способен соединять разделенное;
если среда выходит за эти пределы, разработчики предметной области теряют способность расчленять модель на осмысленные фрагменты.&#8221;</p>
<p>&#8220;If the framework&#8217;s partitioning conventions pull apart the elements implementing the
conceptual objects, the code no longer reveals the model.</p>
<p>There is only so much partitioning a mind can stitch back together, and if the framework uses
it all up, the domain developers lose their ability to chunk the model into meaningful pieces.&#8221;</p>
<p>- &#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; <a class="footnote-reference" href="#fnddd" id="id7">[4]</a></p>
</div></blockquote>
<p>Это привело к такому огромному количеству хитросплетений слушателей, что превосходство в performance было утрачено, но еще раньше была утрачена читаемость кода.
Даже я не мог на следующий день сказать что делает тот или иной фрагмент кода, не говоря уже о специалисте предметной области.
Мало того, что это в корне разрушало принципы Domain-Driven Design, так это еще и в значительной мере <a class="reference internal" href="../../en/how-to-quickly-develop-high-quality-code/"><span class="doc">снижало скорость разработки новых функций проекта</span></a>.</p>
<p>Надежды на такой подход окончательно рухнули когда выяснилось, что каждый экземпляр модели должен изменять значения своих атрибутов, содержащих аннотации агрегации или зависимых от них, в зависимости от контекста использования (выбранной группировки отображения или критериев фильтрации).</p>
<p>Впоследствии модели вернули себе свои концептуальные контуры и читаемость кода, push-алгоритм был заменен на pull-алгоритм (точнее, на hybrid push-pull), и, вместе с тем, был сохранен механизм реакций при добавлении, изменении или удалении объектов.
Для достижения этого результата пришлось своими силами создать библиотеку реализующую паттерн Repository, так как существующих решений для реляционных данных с качественной кодовой базой я не смог найти.
Получилось что-то вроде Object-Relational Mapping (ORM) для JavaScript, включая паттерн Data Mapper (данные могут трансформироваться (отображаться) между объектами и постоянным хранилищем данных).</p>
</div>
<div class="section" id="id8">
<h1><a class="toc-backref" href="#id30">Парадигма реактивного программирования</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h1>
<p>Сегодня модно увлекаться реактивным программированием.
Знаете ли Вы, что разработчики dojo впервые <a class="reference external" href="https://github.com/dojo/dojo/commit/4bd91a5939d4dbc8a43d673cc279bb3d39ed0895#diff-48ec1f2998cbe6d644df0c9abd32d9d0R35">применили реактивное программирование</a> в своей реализации паттерна Repository еще 13 сентября 2010?</p>
<p>Реактивное программирование дополняет (а не противопоставляет) паттерн <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a>, о чем красноречиво свидетельствует опыт <a class="reference external" href="https://dojotoolkit.org/reference-guide/1.10/dojo/store.html">dojo.store</a> и <a class="reference external" href="http://dstorejs.io/">Dstore</a>.</p>
<p>Разработчики dojo - команда высококвалифицированных специалистов, чьи библиотеки используют такие серьезные компании как IBM.
Примером того, насколько серьезно и комплексно они подходят к решению проблем, может служить <a class="reference external" href="http://requirejs.org/docs/history.html">история библиотеки RequireJS</a>.</p>
</div>
<div class="section" id="repository-orm-javascript">
<h1><a class="toc-backref" href="#id31">Примеры реализаций паттерна Repository и ORM в JavaScript</a><a class="headerlink" href="#repository-orm-javascript" title="Permalink to this headline">¶</a></h1>
<p>Примеры простейших реализаций паттерна Repository на JavaScript в проекте <a class="reference external" href="http://todomvc.com/">todomvc.com</a>:</p>
<ul class="simple">
<li>Angular2+: <a class="reference external" href="https://github.com/tastejs/todomvc/blob/master/examples/angular2/app/services/store.ts">https://github.com/tastejs/todomvc/blob/master/examples/angular2/app/services/store.ts</a></li>
<li>Angular2+: <a class="reference external" href="https://github.com/tastejs/todomvc/blob/master/examples/angular2_es2015/app/services/todo-store.service.js">https://github.com/tastejs/todomvc/blob/master/examples/angular2_es2015/app/services/todo-store.service.js</a></li>
<li>AngularJS: <a class="reference external" href="https://github.com/tastejs/todomvc/blob/master/examples/angularjs/js/services/todoStorage.js">https://github.com/tastejs/todomvc/blob/master/examples/angularjs/js/services/todoStorage.js</a></li>
</ul>
<p>Другие реализации:</p>
<ul class="simple">
<li><a class="reference external" href="http://dstorejs.io/">Dstore</a> - yet another excellent implementation of <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a> pattern.</li>
<li><a class="reference external" href="https://dojotoolkit.org/reference-guide/1.10/dojo/store.html">Dojo1 Store</a> - Dojo1 implementation of <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a> pattern.</li>
<li><a class="reference external" href="http://www.js-data.io/">JS-Data</a> - Object-Relational Mapping (ORM) written by JavaScript for relational data. Does not support composite relations.</li>
<li><a class="reference external" href="https://www.sitepoint.com/9-javascript-libraries-working-with-local-storage/">9 JavaScript Libraries for Working with Local Storage</a> - article with interesting comments.</li>
<li><a class="reference external" href="http://devcenter.kinvey.com/angular/guides/datastore">Kinvey Data Store</a> - implementation of <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a> pattern by MBaaS Kinvey, <a class="reference external" href="https://github.com/Kinvey/js-sdk/tree/master/src/datastore/src">source code</a></li>
<li><a class="reference external" href="https://github.com/vincentracine/pocketjs">Pocket.js</a> - a wrapper for the window.localStorage. It provides helpful methods which utilise MongoDB&#8217;s proven syntax and provides a powerful lightweight abstraction from the complexity of managing and querying local storage.</li>
<li><a class="reference external" href="https://erikolson186.github.io/zangodb/">ZangoDB</a> is a MongoDB-like interface for HTML5 IndexedDB that supports most of the familiar filtering, projection, sorting, updating and aggregation features of MongoDB, for usage in the web browser (<a class="reference external" href="https://github.com/erikolson186/zangodb">source code</a>).</li>
<li><a class="reference external" href="http://jsstore.net/">JsStore</a> is SQL Like IndexedDb Wrapper. It provides simple api to store, retrieve, delete, remove, and for other advanced Database functionalities (<a class="reference external" href="https://github.com/ujjwalguptaofficial/JsStore">source code</a>).</li>
<li><a class="reference external" href="https://www.odata.org/libraries/">ODATA libraries</a> - multiple implementations of Open Data Protocol (ODATA).</li>
<li><a class="reference external" href="https://github.com/mWater/minimongo">Minimongo</a> - A client-side MongoDB implementation which supports basic queries, including some geospatial ones.</li>
</ul>
<p>Я не могу добавить сюда <a class="reference external" href="https://emberjs.com/">Ember.js</a>, так как он реализует паттерн <a class="reference external" href="http://www.martinfowler.com/eaaCatalog/activeRecord.html">ActiveRecord</a>.</p>
<p>Отдельно стоит упомянуть библиотеку <a class="reference external" href="https://github.com/persvr/rql">rql</a>, которая позволяет легко реализовывать паттерны <a class="reference external" href="http://martinfowler.com/eaaCatalog/serviceStub.html">Service Stub</a> и <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a>.
Много наработок можно увидеть в проектах <a class="reference external" href="https://github.com/persvr">persvr</a> и <a class="reference external" href="https://github.com/kriszyp">kriszyp</a>.</p>
<p>В текущей статье не рассматриваются примеры реализаций паттернов <a class="reference external" href="https://martinfowler.com/eaaDev/EventSourcing.html">Event Sourcing</a> и <a class="reference external" href="https://martinfowler.com/bliki/CQRS.html">CQRS</a> (о чем ведется речь в статье &#8220;<a class="reference internal" href="../role-of-service-layer-in-cqrs-and-event-sourcing-using-redux-in-angular-as-an-example/"><span class="doc">Роль сервисного слоя в CQRS и Event Sourcing на примере использования Redux в Angular</span></a>&#8221;):</p>
<ul class="simple">
<li>React: <a class="reference external" href="https://github.com/tastejs/todomvc/blob/master/examples/react/js/todoModel.js">https://github.com/tastejs/todomvc/blob/master/examples/react/js/todoModel.js</a></li>
<li>React+Alt: <a class="reference external" href="https://github.com/tastejs/todomvc/blob/master/examples/react-alt/js/stores/todoStore.js">https://github.com/tastejs/todomvc/blob/master/examples/react-alt/js/stores/todoStore.js</a></li>
<li><a class="reference external" href="https://github.com/dojo/stores">Dojo2 Stores</a> - a predictable, consistent state container for Javascript applications with inspiration from Redux and Flux architectures.</li>
</ul>
<p>Данные паттерны используется в распределенных вычислениях и в системах воссоздающих разные состояния системы, но их преимущества на фронтенде не столь очевидны, особенно учитывая тот факт, что именно на фронтенде реализация бизнес-логики бывает наиболее востребованной.</p>
<p>Отдельно стоит упомянуть реализацию реактивных хранилищ основанных на состоянии с использованием библиотеки RxJS, смотрите, например, <a class="reference external" href="https://github.com/ng-book/angular2-rxjs-chat">angular2-rxjs-chat</a>.</p>
</div>
<div class="section" id="id9">
<h1><a class="toc-backref" href="#id32">Реализация реляционных связей</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id10">
<h2><a class="toc-backref" href="#id33">Синхронное программирование</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<p>На заре появления ORM, мапперы делали таким образом, чтобы они извлекали из базы данных все связанные объекты одним запросом (см. <a class="reference external" href="https://bitbucket.org/emacsway/openorm/src/default/python/">пример реализации</a>).</p>
<p>Domain-Driven Design подходит к связям более строго, и рассматривает связи с позиции концептуальных контуров агрегата вложенных объектов <a class="footnote-reference" href="#fnddd" id="id12">[4]</a>.
Доступ к объекту осуществлялся либо по ссылке (от родительского объекта к вложеному или к другому агрегату), либо через Repository (к корню агрегата).
Здесь также особую роль играет направление связей, и соблюдение принципа минимальной достаточности (&#8220;дистиляция моделей&#8221; <a class="footnote-reference" href="#fnddd" id="id13">[4]</a>).</p>
<blockquote>
<div><p>In real life, there are lots of many-to-many associations, and a great number are naturally
bidirectional. The same tends to be true of early forms of a model as we brainstorm and explore
the domain. But these general associations complicate implementation and maintenance.
Furthermore, they communicate very little about the nature of the relationship.</p>
<p>There are at least three ways of making associations more tractable.</p>
<ol class="arabic simple">
<li>Imposing a traversal direction</li>
<li>Adding a qualifier, effectively reducing multiplicity</li>
<li>Eliminating nonessential associations</li>
</ol>
<p>It is important to constrain relationships as much as possible. A bidirectional association means
that both objects can be understood only together. When application requirements do not call for
traversal in both directions, adding a traversal direction reduces interdependence and simplifies
the design. Understanding the domain may reveal a natural directional bias.</p>
<p>- &#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; <a class="footnote-reference" href="#fnddd" id="id14">[4]</a></p>
</div></blockquote>
<blockquote>
<div><p>Minimalist design of associations helps simplify traversal and limit the explosion of relationships
somewhat, but most business domains are so interconnected that we still end up tracing long,
deep paths through object references. In a way, this tangle reflects the realities of the world,
which seldom obliges us with sharp boundaries. It is a problem in a software design.</p>
<p>- &#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; <a class="footnote-reference" href="#fnddd" id="id15">[4]</a></p>
</div></blockquote>
<p>С появлением ORM, в синхронном программировании активно начали применяться ленивые вычисления для разрешения связей.
В Python для этого активно используются <a class="reference external" href="https://docs.python.org/3/howto/descriptor.html">Descriptors</a>, а в Java - AOP и Cross-Cutting Concerns <a class="footnote-reference" href="#fnccode" id="id16">[1]</a>.</p>
<p>Ключевым моментом является освобождение Domain Model от логики доступа к источнику данных.
Это необходимо как из принципа чистоты архитектуры и проектных решений, чтобы снизить сопряжение (<a class="reference external" href="http://wiki.c2.com/?CouplingAndCohesion">Coupling</a>), так и из принципа простоты тестирования.
Наибольших успехов позволяет достигнуть принцип Cross-Cutting Concerns, который полностью освобождает модель от служебной логики.</p>
<p>С появлением ОРМ, организация связей стала настолько легкой, что о ней перестали задумываться.
Там где требуются однонаправленные связи, разработчики с легкостью применяют двунаправленные связи.
Появились механизмы оптимизации выборки связанных объектов, которые неявно предзагружают все связанные объекты, что значительно сокращает количество обращений в базу данных.</p>
</div>
<div class="section" id="id17">
<h2><a class="toc-backref" href="#id34">Асинхронное программирование</a><a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h2>
<p>Рост популярности асинхронных приложений заставил пересмотреть устоявшиеся представления о ленивой реализации связей.
Асинхронное обращение к каждой ленивой связи каждого объекта значительно усложняет ясность программного кода, и препятствует оптимизации.</p>
<p>Это способствовало росту популярности объектно-ориентированных баз данных в асинхронном программировании, которые позволяют сохранять агрегаты целиком.
Все чаще REST-frameworks стали использоваться для передачи клиенту <a class="reference external" href="http://www.django-rest-framework.org/api-guide/serializers/#dealing-with-nested-objects">агрегатов вложенных объектов</a>.</p>
<blockquote>
<div><p>To do anything with an object, you have to hold a reference to it. How do you get that reference?
One way is to create the object, as the creation operation will return a reference to the new
object. A second way is to traverse an association. You start with an object you already know and
ask it for an associated object. Any object-oriented program is going to do a lot of this, and these
links give object models much of their expressive power. But you have to get that first object.</p>
<p>I actually encountered a project once in which the team was attempting, in an enthusiastic
embrace of MODEL-DRIVEN DESIGN , to do all object access by creation or traversal! Their objects
resided in an object database, and they reasoned that existing conceptual relationships would
provide all necessary associations. They needed only to analyze them enough, making their entire
domain model cohesive. This self-imposed limitation forced them to create just the kind of endless
tangle that we have been trying to avert over the last few chapters, with careful implementation of
ENTITIES and application of AGGREGATES . The team members didn&#8217;t stick with this strategy long, but
they never replaced it with another coherent approach. They cobbled together ad hoc solutions
and became less ambitious.</p>
<p>Few would even think of this approach, much less be tempted by it, because they store most oftheir objects in relational databases.
This storage technology makes it natural to use the third way
of getting a reference: Execute a query to find the object in a database based on its attributes, or
find the constituents of an object and then reconstitute it.</p>
<p>- &#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; <a class="footnote-reference" href="#fnddd" id="id19">[4]</a></p>
</div></blockquote>
<p>Необходимость обхода вложенных структур данных активизировала интерес к функциональному программированию, особенно в сочетании с парадигмой реактивного программирования.</p>
</div>
<div class="section" id="id20">
<h2><a class="toc-backref" href="#id35">Реализация связей путем присваивания</a><a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h2>
<p>Хотя агрегат не совместим со связями типа Many-To-Many и перекрестными иерархиями связей, все-же он может ссылаться на корень другого агрегата:</p>
<blockquote>
<div><p>Objects within the AGGREGATE can hold references to other AGGREGATE roots.</p>
<p>- &#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; <a class="footnote-reference" href="#fnddd" id="id21">[4]</a> by Eric Evans</p>
</div></blockquote>
<blockquote>
<div><p>Since one Aggregate instance can reference other Aggregate instances, can the associations be navigated deeply, modifying various objects along the way?</p>
<p>- &#8220;Implementing Domain-Driven Design&#8221; <a class="footnote-reference" href="#fniddd" id="id22">[5]</a> by Vaughn Vernon</p>
</div></blockquote>
<blockquote>
<div><p>When designing Aggregates, we may desire a compositional structure that allows for traversal through deep object graphs, but that is not the motivation of the pattern. [Evans] states that one Aggregate may hold references to the Root of other Aggregates. However, we must keep in mind that this does not place the referenced Aggregate inside the consistency boundary of the one referencing it. The reference does not cause the formation of just one whole Aggregate. There are still two (or more), as shown in Figure 10.5.</p>
<p>- &#8220;Implementing Domain-Driven Design&#8221; <a class="footnote-reference" href="#fniddd" id="id23">[5]</a> by Vaughn Vernon</p>
</div></blockquote>
<blockquote>
<div><p>Having an Application Service resolve dependencies frees the Aggregate from relying on either a Repository or a Domain Service. However, for very complex and domain-specific dependency resolutions, passing a Domain Service into an Aggregate command method can be the best way to go. The Aggregate can then double-dispatch to the Domain Service to resolve references. Again, in whatever way one Aggregate gains access to others, referencing multiple Aggregates in one request does not give license to cause modification on two or more of them.</p>
<p>- &#8220;Implementing Domain-Driven Design&#8221; <a class="footnote-reference" href="#fniddd" id="id24">[5]</a> by Vaughn Vernon</p>
</div></blockquote>
<p>Принцип физического присваивания связанных объектов <a class="reference external" href="http://www.js-data.io/v3.0/docs/relations#section-eagerly-loading-relations">реализован также и в библиотеке js-data</a>.</p>
<p>В нашей библиотеке мы предусмотрели как возможность декомпозиции вложенных объектов, так и возможность их композиции из плоских данных в Repositories.
Причем, коллекции выбранных объектов всегда сохраняет актуальное состояние, и при добавлении, изменении, удалении объекта в Repository, изменения автоматически отображаются в соответствующих коллекциях.
Библиотека реализует это поведение как в парадигме Реактивного программирования, так и в парадигме Событийно-ориентированного программирования (на выбор).</p>
<p>Существует также возможность формировать двусторонние связи.
Но, несмотря на то, что современные интерпретаторы легко чистят мусор с кольцевыми ссылками, с концептуальной точки зрения лучше когда вложенные объекты не осведомлены о своем родителе, если на то нет веских оснований.</p>
<p>Таким образом, для реализации связей объекту совершенно не требуется никакая служебная логика доступа к данным, что поддерживает нулевое сопряжение (<a class="reference external" href="http://wiki.c2.com/?CouplingAndCohesion">Coupling</a>) и образует кристально чистые доменные модели.
Это значит, что доменные модели могут быть инстанцией &#8220;класса&#8221; Object.</p>
</div>
</div>
<div class="section" id="id25">
<h1><a class="toc-backref" href="#id36">Исходный код</a><a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>Edge (unstable) repo - <a class="reference external" href="https://github.com/emacsway/store">https://github.com/emacsway/store</a></li>
<li>Canonical repo - <a class="reference external" href="https://github.com/joor/store-js-external">https://github.com/joor/store-js-external</a></li>
</ul>
<p>This article in English &#8220;<a class="reference internal" href="../../en/javascript-and-repository-pattern/"><span class="doc">Implementation of Repository pattern for browser&#8217;s JavaScript</span></a>&#8221;.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="fnccode" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td><em>(<a class="fn-backref" href="#id2">1</a>, <a class="fn-backref" href="#id16">2</a>)</em> &#8220;<a class="reference external" href="http://www.informit.com/store/clean-code-a-handbook-of-agile-software-craftsmanship-9780132350884">Clean Code: A Handbook of Agile Software Craftsmanship</a>&#8221; by <a class="reference external" href="http://informit.com/martinseries">Robert C. Martin</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fncodec" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[2]</td><td>&#8220;<a class="reference external" href="http://www.informit.com/store/code-complete-9780735619678">Code Complete</a>&#8221; Steve McConnell</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnpoeaa" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[3]</td><td>&#8220;<a class="reference external" href="https://www.martinfowler.com/books/eaa.html">Patterns of Enterprise Application Architecture</a>&#8221; by <a class="reference external" href="https://martinfowler.com/aboutMe.html">Martin Fowler</a>, David Rice, Matthew Foemmel, Edward Hieatt, Robert Mee, Randy Stafford</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnddd" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[4]</td><td><em>(<a class="fn-backref" href="#id4">1</a>, <a class="fn-backref" href="#id7">2</a>, <a class="fn-backref" href="#id12">3</a>, <a class="fn-backref" href="#id13">4</a>, <a class="fn-backref" href="#id14">5</a>, <a class="fn-backref" href="#id15">6</a>, <a class="fn-backref" href="#id19">7</a>, <a class="fn-backref" href="#id21">8</a>)</em> &#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; by Eric Evans</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fniddd" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[5]</td><td><em>(<a class="fn-backref" href="#id22">1</a>, <a class="fn-backref" href="#id23">2</a>, <a class="fn-backref" href="#id24">3</a>)</em> &#8220;Implementing Domain-Driven Design&#8221; by Vaughn Vernon</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fngof" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[6]</td><td>&#8220;Design Patterns Elements of Reusable Object-Oriented Software&#8221; by Erich Gamma, Richard Helm, Ralph Johnson, John Vlissides, 1994</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnrefactoring" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[7]</a></td><td>&#8220;<a class="reference external" href="https://martinfowler.com/books/refactoring.html">Refactoring: Improving the Design of Existing Code</a>&#8221; by <a class="reference external" href="https://martinfowler.com/aboutMe.html">Martin Fowler</a>, Kent Beck, John Brant, William Opdyke, Don Roberts</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnoovsop" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[8]</td><td>&#8220;<a class="reference external" href="http://blog.cleancoder.com/uncle-bob/2014/11/24/FPvsOO.html">OO vs FP</a>&#8221; by Robert C. Martin</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnca" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[9]</td><td>&#8220;<a class="reference external" href="https://8thlight.com/blog/uncle-bob/2011/11/22/Clean-Architecture.html">Clean Architecture</a>&#8221; by Robert C. Martin</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fntca" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[10]</td><td>&#8220;<a class="reference external" href="https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html">The Clean Architecture</a>&#8221; by Robert C. Martin</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnxp" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[11]</td><td><em>(<a class="fn-backref" href="#id3">1</a>, <a class="fn-backref" href="#id6">2</a>)</em> &#8220;<a class="reference external" href="http://www.informit.com/store/extreme-programming-explained-embrace-change-9780321278654">Extreme Programming Explained</a>&#8221; by Kent Beck</td></tr>
</tbody>
</table>
<div class="note update admonition">
<p class="first last admonition-title">Updated on May 26, 2018</p>
</div>
</div>

  <div class="section">
  
    


<div class="section">
  <span style="float: left;">
  
  
  <a href="../../en/javascript-and-repository-pattern/">
    <i class="fa fa-arrow-circle-left"></i>
    Implementation of Repository pattern for browser's JavaScript
  </a>
  
  </span>
  <span>&nbsp;</span>
  <span style="float: right;">
  
  
  <a href="../it-hiring/">
    О проблемах подбора персонала в IT-индустрии
    <i class="fa fa-arrow-circle-right"></i>
  </a>
  </span>
  
</div>

  
  
    <div class="section">
    <h2>Comments</h2>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'emacsway';
        var disqus_identifier = '/ru/javascript-and-repository-pattern/';
        var disqus_title = 'Реализация паттерна Repository в браузерном JavaScript';
        var disqus_url = 'https://emacsway.github.io/ru/javascript-and-repository-pattern/';

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  
  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../">
    <img class="logo" src="../../_static/logo.jpg" alt="Logo"/>
    
    <h1 class="logo logo-name">@emacsway's blog</h1>
    
  </a>
</p>









  
  
  <h2>
  
  <i class="fa fa-calendar"></i>
    Aug 06, 2017
  
  </h2>

  <ul>
    
  <li><i class="fa fa-pencil-square-o"></i>
    May 26, 2018</li>
  

  
  <li><i class="fa-fw fa fa-user"></i>
    
      
      <a href="../../blog/author/ivan-zakrevsky/">Ivan Zakrevsky</a>
      
    </li>
  

  

  
  <li><i class="fa-fw fa fa-language"></i>
    
      
      <a href="../../blog/language/russian/">Russian</a>
      
    </li>
  

  

  
  <li><i class="fa-fw fa fa-tags"></i>
      
    
      
      <a href="../../blog/tag/repository/">Repository</a>,
      
    
      
      <a href="../../blog/tag/orm/">ORM</a>,
      
    
      
      <a href="../../blog/tag/javascript/">JavaScript</a>,
      
    
      
      <a href="../../blog/tag/model/">Model</a>,
      
    
      
      <a href="../../blog/tag/ddd/">DDD</a>
      
    </li>
  
  
  <li>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'emacsway'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
    <i class="fa-fw fa fa-comments"></i>
    <a href="#disqus_thread" data-disqus-identifier="/ru/javascript-and-repository-pattern/"> </a>
  </li>
  
  </ul>


<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about/">About me</a></li>
</ul>


  <h3><a href="../../blog/">Recent Posts</a></h3>
  <ul>
    
    
      <li><a href="../self-learning-for-software-engineer/">Oct 11 - Список литературы для самообучения разработчика программного обеспечения</a></li>
    
      <li><a href="../tdd/">Sep 30 - TDD - Разработка через тестирование</a></li>
    
      <li><a href="../role-of-service-layer-in-cqrs-and-event-sourcing-using-redux-in-angular-as-an-example/">Sep 16 - Роль сервисного слоя в CQRS и Event Sourcing на примере использования Redux в Angular</a></li>
    
      <li><a href="../easily-about-agile-way-to-rapid-development/">Sep 15 - Про Agile на пальцах. Путь к быстрой разработке.</a></li>
    
      <li><a href="../anemic-domain-model/">Jan 04 - Про Anemic Domain Model</a></li>
    
  </ul>

  <h3><a href="../../blog/tag/">Tags</a></h3>
  <style type="text/css">
    ul.ablog-cloud {list-style: none; overflow: auto;}
    ul.ablog-cloud li {float: left; height: 20pt; line-height: 18pt; margin-right: 5px;}
    ul.ablog-cloud a {text-decoration: none; vertical-align: middle;}
    li.ablog-cloud-1{font-size: 80%;}
    li.ablog-cloud-2{font-size: 95%;}
    li.ablog-cloud-3{font-size: 110%;}
    li.ablog-cloud-4{font-size: 125%;}
    li.ablog-cloud-5{font-size: 140%;}
  </style>
  <ul class="ablog-cloud">
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/agile/">Agile</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/angular/">Angular</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-3">
        <a href="../../blog/tag/architecture/">Architecture</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/cqrs/">CQRS</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/clean-code/">Clean Code</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/db/">DB</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/ddd/">DDD</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/datamapper/">DataMapper</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/dependency-injection/">Dependency Injection</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/design/">Design</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/django/">Django</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-3">
        <a href="../../blog/tag/django-model/">Django Model</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/docker/">Docker</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/emacs/">Emacs</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/event-sourcing/">Event Sourcing</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/extreme-programming/">Extreme Programming</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/flux/">Flux</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/fowler/">Fowler</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/hr/">HR</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/hiring/">Hiring</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/javascript/">JavaScript</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-4">
        <a href="../../blog/tag/model/">Model</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-5">
        <a href="../../blog/tag/orm/">ORM</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-4">
        <a href="../../blog/tag/python/">Python</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/redux/">Redux</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/refactoring/">Refactoring</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/repository/">Repository</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/sql/">SQL</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/scrum/">Scrum</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/service-layer/">Service Layer</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/storm-orm/">Storm ORM</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/tdd/">TDD</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/xp/">XP</a></li>
      
    
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/autocomplete/">autocomplete</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/cache/">cache</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/programming/">programming</a></li>
      
    
  </ul>

  <h3><a href="../../blog/category/">Categories</a></h3>
  <ul>
  
    
    <li><a href="../../blog/category/architecture/">Architecture (1)</a></li>
    
  
    
    <li><a href="../../blog/category/cqrs/">CQRS (1)</a></li>
    
  
    
    <li><a href="../../blog/category/clean-architecture/">Clean Architecture (1)</a></li>
    
  
    
    <li><a href="../../blog/category/clean-code/">Clean Code (1)</a></li>
    
  
    
    <li><a href="../../blog/category/ddd/">DDD (1)</a></li>
    
  
    
    <li><a href="../../blog/category/event-sourcing/">Event Sourcing (1)</a></li>
    
  
    
    <li><a href="../../blog/category/event-driven/">Event-Driven (1)</a></li>
    
  
    
    <li><a href="../../blog/category/extreme-programming/">Extreme Programming (1)</a></li>
    
  
    
    <li><a href="../../blog/category/microservices/">Microservices (1)</a></li>
    
  
    
    <li><a href="../../blog/category/refactoring/">Refactoring (1)</a></li>
    
  
    
    <li><a href="../../blog/category/tdd/">TDD (1)</a></li>
    
  
    
    <li><a href="../../blog/category/xp/">XP (1)</a></li>
    
  
    
    <li><a href="../../blog/category/programming/">programming (1)</a></li>
    
  
  </ul>

  <h3><a href="../../blog/archive/">Archives</a></h3>
  <ul>
  
    
    <li><a href="../../blog/2019/">2019 (2)</a></li>
    
  
    
    <li><a href="../../blog/2018/">2018 (4)</a></li>
    
  
    
    <li><a href="../../blog/2017/">2017 (9)</a></li>
    
  
    
    <li><a href="../../blog/2016/">2016 (5)</a></li>
    
  
    
    <li><a href="../../blog/2015/">2015 (6)</a></li>
    
  
  </ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

    <div class="footer">
      &copy;2019, Ivan Zakrevsky.
      
      |
      Powered by <a href="http://ablog.readthedocs.org/">ABlog</a> &amp; <a href="http://sphinx-doc.org/">Sphinx 1.4.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
      |
      <a href="../../_sources/ru/javascript-and-repository-pattern.txt"
          rel="nofollow">Page source</a>
    </div>

    

    


    

        <!-- Go to www.addthis.com/dashboard to customize your tools -->
        <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-597ba7fb5af2ef1e"></script>

    


<!-- google.com/analytics counter -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-69288289-1', 'auto');
  ga('send', 'pageview');

</script>
<!-- /google.com/analytics counter -->


<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function (d, w, c) {
        (w[c] = w[c] || []).push(function() {
            try {
                w.yaCounter32948409 = new Ya.Metrika({
                    id:32948409,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true
                });
            } catch(e) { }
        });

        var n = d.getElementsByTagName("script")[0],
            s = d.createElement("script"),
            f = function () { n.parentNode.insertBefore(s, n); };
        s.type = "text/javascript";
        s.async = true;
        s.src = "https://mc.yandex.ru/metrika/watch.js";

        if (w.opera == "[object Opera]") {
            d.addEventListener("DOMContentLoaded", f, false);
        } else { f(); }
    })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/32948409" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->



  </body>
</html>